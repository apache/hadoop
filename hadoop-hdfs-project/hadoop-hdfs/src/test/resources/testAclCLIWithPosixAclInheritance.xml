<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet type="text/xsl" href="testConf.xsl"?>

<!--
   Licensed to the Apache Software Foundation (ASF) under one or more
   contributor license agreements.  See the NOTICE file distributed with
   this work for additional information regarding copyright ownership.
   The ASF licenses this file to You under the Apache License, Version 2.0
   (the "License"); you may not use this file except in compliance with
   the License.  You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

   Unless required by applicable law or agreed to in writing, software
   distributed under the License is distributed on an "AS IS" BASIS,
   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   See the License for the specific language governing permissions and
   limitations under the License.
-->

<configuration>
  <!-- Normal mode is test. To run just the commands and dump the output
       to the log, set it to nocompare -->
  <mode>test</mode>

  <!--  Comparator types:
           ExactComparator
           SubstringComparator
           RegexpComparator
           TokenComparator
           -->
  <tests>
    <!-- Tests for setfacl and getfacl-->
    <test>
      <description>getfacl: basic permissions</description>
      <test-commands>
        <command>-fs NAMENODE -touchz /file1</command>
        <command>-fs NAMENODE -getfacl /file1</command>
      </test-commands>
      <cleanup-commands>
        <command>-fs NAMENODE -rm /file1</command>
      </cleanup-commands>
      <comparators>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output># file: /file1</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output># owner: USERNAME</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output># group: supergroup</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>user::rw-</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>group::r--</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>other::r--</expected-output>
        </comparator>
      </comparators>
    </test>
    <test>
      <description>getfacl: basic permissions for directory</description>
      <test-commands>
        <command>-fs NAMENODE -mkdir /dir1</command>
        <command>-fs NAMENODE -getfacl /dir1</command>
      </test-commands>
      <cleanup-commands>
        <command>-fs NAMENODE -rm /dir1</command>
      </cleanup-commands>
      <comparators>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output># file: /dir1</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output># owner: USERNAME</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output># group: supergroup</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>user::rwx</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>group::r-x</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>other::r-x</expected-output>
        </comparator>
      </comparators>
    </test>
    <test>
      <description>setfacl : Add an ACL</description>
      <test-commands>
        <command>-fs NAMENODE -touchz /file1</command>
        <command>-fs NAMENODE -setfacl -m user:bob:r-- /file1</command>
        <command>-fs NAMENODE -getfacl /file1</command>
      </test-commands>
      <cleanup-commands>
        <command>-fs NAMENODE -rm /file1</command>
      </cleanup-commands>
      <comparators>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output># file: /file1</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output># owner: USERNAME</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output># group: supergroup</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>user::rw-</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>user:bob:r--</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>group::r--</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>mask::r--</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>other::r--</expected-output>
        </comparator>
      </comparators>
    </test>
    <test>
      <description>setfacl : Add multiple ACLs at once</description>
      <test-commands>
        <command>-fs NAMENODE -touchz /file1</command>
        <command>-fs NAMENODE -setfacl -m user:bob:r--,group:users:r-x /file1</command>
        <command>-fs NAMENODE -getfacl /file1</command>
      </test-commands>
      <cleanup-commands>
        <command>-fs NAMENODE -rm /file1</command>
      </cleanup-commands>
      <comparators>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output># file: /file1</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output># owner: USERNAME</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output># group: supergroup</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>user::rw-</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>user:bob:r--</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>group::r--</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>group:users:r-x</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>mask::r-x</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>other::r--</expected-output>
        </comparator>
      </comparators>
    </test>
    <test>
      <description>setfacl : Remove an ACL</description>
      <test-commands>
        <command>-fs NAMENODE -touchz /file1</command>
        <command>-fs NAMENODE -setfacl -m user:bob:r--,user:charlie:r-x /file1</command>
        <command>-fs NAMENODE -setfacl -x user:bob /file1</command>
        <command>-fs NAMENODE -getfacl /file1</command>
      </test-commands>
      <cleanup-commands>
        <command>-fs NAMENODE -rm /file1</command>
      </cleanup-commands>
      <comparators>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output># file: /file1</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output># owner: USERNAME</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output># group: supergroup</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>user::rw-</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>user:charlie:r-x</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>group::r--</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>other::r--</expected-output>
        </comparator>
        <comparator>
          <type>RegexpAcrossOutputComparator</type>
          <expected-output>.*(?!bob)*</expected-output>
        </comparator>
      </comparators>
    </test>
    <test>
      <description>setfacl : Add default ACL</description>
      <test-commands>
        <command>-fs NAMENODE -mkdir /dir1</command>
        <command>-fs NAMENODE -setfacl -m user:bob:r--,group:users:r-x /dir1</command>
        <command>-fs NAMENODE -setfacl -m default:user:charlie:r-x,default:group:admin:rwx /dir1</command>
        <command>-fs NAMENODE -getfacl /dir1</command>
      </test-commands>
      <cleanup-commands>
        <command>-fs NAMENODE -rm -R /dir1</command>
      </cleanup-commands>
      <comparators>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output># file: /dir1</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output># owner: USERNAME</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output># group: supergroup</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>user::rwx</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>user:bob:r--</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>group::r-x</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>group:users:r-x</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>mask::r-x</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>other::r-x</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>default:user::rwx</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>default:user:charlie:r-x</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>default:group::r-x</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>default:group:admin:rwx</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>default:mask::rwx</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>default:other::r-x</expected-output>
        </comparator>
      </comparators>
    </test>
    <test>
      <description>setfacl : Add minimal default ACL</description>
      <test-commands>
        <command>-fs NAMENODE -mkdir /dir1</command>
        <command>-fs NAMENODE -setfacl -m default:user::rwx /dir1</command>
        <command>-fs NAMENODE -getfacl /dir1</command>
      </test-commands>
      <cleanup-commands>
        <command>-fs NAMENODE -rm -R /dir1</command>
      </cleanup-commands>
      <comparators>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output># file: /dir1</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output># owner: USERNAME</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output># group: supergroup</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>user::rwx</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>group::r-x</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>other::r-x</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>default:user::rwx</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>default:group::r-x</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>default:other::r-x</expected-output>
        </comparator>
        <comparator>
          <type>RegexpAcrossOutputComparator</type>
          <expected-output>.*(?!default\:mask)*</expected-output>
        </comparator>
      </comparators>
    </test>
    <test>
      <description>setfacl : try adding default ACL to file</description>
      <test-commands>
        <command>-fs NAMENODE -touchz /file1</command>
        <command>-fs NAMENODE -setfacl -m default:user:charlie:r-x /file1</command>
      </test-commands>
      <cleanup-commands>
        <command>-fs NAMENODE -rm /file1</command>
      </cleanup-commands>
      <comparators>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>setfacl: Invalid ACL: only directories may have a default ACL</expected-output>
        </comparator>
      </comparators>
    </test>
    <test>
      <description>setfacl : Remove one default ACL</description>
      <test-commands>
        <command>-fs NAMENODE -mkdir /dir1</command>
        <command>-fs NAMENODE -setfacl -m user:bob:r--,group:users:r-x /dir1</command>
        <command>-fs NAMENODE -setfacl -m default:user:charlie:r-x,default:group:admin:rwx /dir1</command>
        <command>-fs NAMENODE -setfacl -x default:user:charlie /dir1</command>
        <command>-fs NAMENODE -getfacl /dir1</command>
      </test-commands>
      <cleanup-commands>
        <command>-fs NAMENODE -rm -R /dir1</command>
      </cleanup-commands>
      <comparators>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output># file: /dir1</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output># owner: USERNAME</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output># group: supergroup</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>user::rwx</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>user:bob:r--</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>group::r-x</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>group:users:r-x</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>mask::r-x</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>other::r-x</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>default:user::rwx</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>default:group::r-x</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>default:group:admin:rwx</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>default:mask::rwx</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>default:other::r-x</expected-output>
        </comparator>
        <comparator>
          <type>RegexpAcrossOutputComparator</type>
          <expected-output>.*(?!default:user:charlie).*</expected-output>
        </comparator>
      </comparators>
    </test>
    <test>
      <description>setfacl : Remove all default ACL</description>
      <test-commands>
        <command>-fs NAMENODE -mkdir /dir1</command>
        <command>-fs NAMENODE -setfacl -m user:bob:r--,group:users:r-x /dir1</command>
        <command>-fs NAMENODE -setfacl -m default:user:charlie:r-x,default:group:admin:rwx /dir1</command>
        <command>-fs NAMENODE -setfacl -k /dir1</command>
        <command>-fs NAMENODE -getfacl /dir1</command>
      </test-commands>
      <cleanup-commands>
        <command>-fs NAMENODE -rm -R /dir1</command>
      </cleanup-commands>
      <comparators>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output># file: /dir1</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output># owner: USERNAME</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output># group: supergroup</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>user::rwx</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>user:bob:r--</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>group::r-x</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>group:users:r-x</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>mask::r-x</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>other::r-x</expected-output>
        </comparator>
        <comparator>
          <type>RegexpAcrossOutputComparator</type>
          <expected-output>.*(?!default).*</expected-output>
        </comparator>
      </comparators>
    </test>
    <test>
      <description>setfacl : Remove all but base ACLs for a directory</description>
      <test-commands>
        <command>-fs NAMENODE -mkdir /dir1</command>
        <command>-fs NAMENODE -setfacl -m user:charlie:r-x,default:group:admin:rwx /dir1</command>
        <command>-fs NAMENODE -setfacl -b /dir1</command>
        <command>-fs NAMENODE -getfacl /dir1</command>
      </test-commands>
      <cleanup-commands>
        <command>-fs NAMENODE -rm -R /dir1</command>
      </cleanup-commands>
      <comparators>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output># file: /dir1</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output># owner: USERNAME</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output># group: supergroup</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>user::rwx</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>group::r-x</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>other::r-x</expected-output>
        </comparator>
        <comparator>
          <type>RegexpAcrossOutputComparator</type>
          <expected-output>.*(?!charlie).*</expected-output>
        </comparator>
        <comparator>
          <type>RegexpAcrossOutputComparator</type>
          <expected-output>.*(?!default).*</expected-output>
        </comparator>
        <comparator>
          <type>RegexpAcrossOutputComparator</type>
          <expected-output>.*(?!admin).*</expected-output>
        </comparator>
      </comparators>
    </test>
    <test>
      <description>setfacl : Remove all but base ACLs for a file</description>
      <test-commands>
        <command>-fs NAMENODE -touchz /file1</command>
        <command>-fs NAMENODE -setfacl -m user:charlie:r-x,group:admin:rwx /file1</command>
        <command>-fs NAMENODE -setfacl -b /file1</command>
        <command>-fs NAMENODE -getfacl /file1</command>
      </test-commands>
      <cleanup-commands>
        <command>-fs NAMENODE -rm /file1</command>
      </cleanup-commands>
      <comparators>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output># file: /file1</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output># owner: USERNAME</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output># group: supergroup</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>user::rw-</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>group::r--</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>other::r--</expected-output>
        </comparator>
        <comparator>
          <type>RegexpAcrossOutputComparator</type>
          <expected-output>.*(?!charlie).*</expected-output>
        </comparator>
        <comparator>
          <type>RegexpAcrossOutputComparator</type>
          <expected-output>.*(?!admin).*</expected-output>
        </comparator>
      </comparators>
    </test>
    <test>
      <description>setfacl : check inherit default ACL to file</description>
      <test-commands>
        <command>-fs NAMENODE -mkdir /dir1</command>
        <command>-fs NAMENODE -setfacl -m default:user:charlie:r-x,default:group:admin:rwx /dir1</command>
        <command>-fs NAMENODE -touchz /dir1/file</command>
        <command>-fs NAMENODE -getfacl /dir1/file</command>
      </test-commands>
      <cleanup-commands>
        <command>-fs NAMENODE -rm -R /dir1</command>
      </cleanup-commands>
      <comparators>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output># file: /dir1/file</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output># owner: USERNAME</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output># group: supergroup</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>user::rw-</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>user:charlie:r-x</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>group::r-x</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>group:admin:rwx</expected-output>
        </comparator>
        <comparator>
          <type>RegexpComparator</type>
          <expected-output>^mask::rw-$</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>other::r--</expected-output>
        </comparator>
        <comparator>
          <type>RegexpAcrossOutputComparator</type>
          <expected-output>.*(?!default).*</expected-output>
        </comparator>
      </comparators>
    </test>
    <test>
      <description>setfacl : check inherit default ACL to dir</description>
      <test-commands>
        <command>-fs NAMENODE -mkdir /dir1</command>
        <command>-fs NAMENODE -setfacl -m default:user:charlie:r-x,default:group:admin:rwx /dir1</command>
        <command>-fs NAMENODE -mkdir /dir1/dir2</command>
        <command>-fs NAMENODE -getfacl /dir1/dir2</command>
      </test-commands>
      <cleanup-commands>
        <command>-fs NAMENODE -rm -R /dir1</command>
      </cleanup-commands>
      <comparators>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output># file: /dir1/dir2</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output># owner: USERNAME</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output># group: supergroup</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>user::rwx</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>user:charlie:r-x</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>group::r-x</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>group:admin:rwx</expected-output>
        </comparator>
        <comparator>
          <type>RegexpComparator</type>
          <expected-output>^mask::rwx$</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>default:user::rwx</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>default:user:charlie:r-x</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>default:group::r-x</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>default:group:admin:rwx</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>default:mask::rwx</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>default:other::r-x</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>other::r-x</expected-output>
        </comparator>
      </comparators>
    </test>
    <test>
      <description>getfacl -R : recursive</description>
      <test-commands>
        <command>-fs NAMENODE -mkdir /dir1</command>
        <command>-fs NAMENODE -setfacl -m user:charlie:r-x,group:admin:rwx /dir1</command>
        <command>-fs NAMENODE -mkdir /dir1/dir2</command>
        <command>-fs NAMENODE -setfacl -m user:user1:r-x,group:users:rwx /dir1/dir2</command>
        <command>-fs NAMENODE -getfacl -R /dir1</command>
      </test-commands>
      <cleanup-commands>
        <command>-fs NAMENODE -rm -R /dir1</command>
      </cleanup-commands>
      <comparators>
        <comparator>
          <type>ExactComparator</type>
          <expected-output># file: /dir1#LF## owner: USERNAME#LF## group: supergroup#LF#user::rwx#LF#user:charlie:r-x#LF#group::r-x#LF#group:admin:rwx#LF#mask::rwx#LF#other::r-x#LF##LF## file: /dir1/dir2#LF## owner: USERNAME#LF## group: supergroup#LF#user::rwx#LF#user:user1:r-x#LF#group::r-x#LF#group:users:rwx#LF#mask::rwx#LF#other::r-x#LF##LF#</expected-output>
        </comparator>
      </comparators>
    </test>
    <test>
      <description>setfacl -R : recursive</description>
      <test-commands>
        <command>-fs NAMENODE -mkdir /dir1</command>
        <command>-fs NAMENODE -mkdir /dir1/dir2</command>
        <command>-fs NAMENODE -setfacl -R -m user:charlie:r-x,group:admin:rwx /dir1</command>
        <command>-fs NAMENODE -getfacl -R /dir1</command>
      </test-commands>
      <cleanup-commands>
        <command>-fs NAMENODE -rm -R /dir1</command>
      </cleanup-commands>
      <comparators>
        <comparator>
          <type>ExactComparator</type>
          <expected-output># file: /dir1#LF## owner: USERNAME#LF## group: supergroup#LF#user::rwx#LF#user:charlie:r-x#LF#group::r-x#LF#group:admin:rwx#LF#mask::rwx#LF#other::r-x#LF##LF## file: /dir1/dir2#LF## owner: USERNAME#LF## group: supergroup#LF#user::rwx#LF#user:charlie:r-x#LF#group::r-x#LF#group:admin:rwx#LF#mask::rwx#LF#other::r-x#LF##LF#</expected-output>
        </comparator>
      </comparators>
    </test>
    <test>
      <description>setfacl --set : Set full set of ACLs</description>
      <test-commands>
        <command>-fs NAMENODE -mkdir /dir1</command>
        <command>-fs NAMENODE -setfacl -m user:charlie:r-x,group:admin:rwx /dir1</command>
        <command>-fs NAMENODE -setfacl --set user::rw-,group::r--,other::r--,user:user1:r-x,group:users:rw- /dir1</command>
        <command>-fs NAMENODE -getfacl /dir1</command>
      </test-commands>
      <cleanup-commands>
        <command>-fs NAMENODE -rm -R /dir1</command>
      </cleanup-commands>
      <comparators>
        <comparator>
          <type>ExactComparator</type>
          <expected-output># file: /dir1#LF## owner: USERNAME#LF## group: supergroup#LF#user::rw-#LF#user:user1:r-x#LF#group::r--#LF#group:users:rw-#LF#mask::rwx#LF#other::r--#LF##LF#</expected-output>
        </comparator>
      </comparators>
    </test>
    <test>
      <description>setfacl -x mask : remove mask entry along with other ACL entries</description>
      <test-commands>
        <command>-fs NAMENODE -mkdir /dir1</command>
        <command>-fs NAMENODE -setfacl -m user:charlie:r-x,group:admin:rwx /dir1</command>
        <command>-fs NAMENODE -setfacl -x mask::,user:charlie,group:admin /dir1</command>
        <command>-fs NAMENODE -getfacl /dir1</command>
      </test-commands>
      <cleanup-commands>
        <command>-fs NAMENODE -rm -R /dir1</command>
      </cleanup-commands>
      <comparators>
        <comparator>
          <type>ExactComparator</type>
          <expected-output># file: /dir1#LF## owner: USERNAME#LF## group: supergroup#LF#user::rwx#LF#group::r-x#LF#other::r-x#LF##LF#</expected-output>
        </comparator>
      </comparators>
    </test>
    <test>
      <description>getfacl: only default ACL</description>
      <test-commands>
        <command>-fs NAMENODE -mkdir /dir1</command>
        <command>-fs NAMENODE -setfacl -m default:user:charlie:rwx /dir1</command>
        <command>-fs NAMENODE -getfacl /dir1</command>
      </test-commands>
      <cleanup-commands>
        <command>-fs NAMENODE -rm -R /dir1</command>
      </cleanup-commands>
      <comparators>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output># file: /dir1</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output># owner: USERNAME</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output># group: supergroup</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>user::rwx</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>group::r-x</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>other::r-x</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>default:user::rwx</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>default:user:charlie:rwx</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>default:group::r-x</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>default:mask::rwx</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>default:other::r-x</expected-output>
        </comparator>
      </comparators>
    </test>
    <test>
      <description>getfacl: effective permissions</description>
      <test-commands>
        <command>-fs NAMENODE -mkdir /dir1</command>
        <command>-fs NAMENODE -setfacl -m user:charlie:rwx,group::-wx,group:sales:rwx,mask::r-x,default:user:charlie:rwx,default:group::r-x,default:group:sales:rwx,default:mask::rw- /dir1</command>
        <command>-fs NAMENODE -getfacl /dir1</command>
      </test-commands>
      <cleanup-commands>
        <command>-fs NAMENODE -rm -R /dir1</command>
      </cleanup-commands>
      <comparators>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output># file: /dir1</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output># owner: USERNAME</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output># group: supergroup</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>user::rwx</expected-output>
        </comparator>
        <comparator>
          <type>RegexpComparator</type>
          <expected-output>^user:charlie:rwx\t#effective:r-x$</expected-output>
        </comparator>
        <comparator>
          <type>RegexpComparator</type>
          <expected-output>^group::-wx\t#effective:--x$</expected-output>
        </comparator>
        <comparator>
          <type>RegexpComparator</type>
          <expected-output>^group:sales:rwx\t#effective:r-x$</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>mask::r-x</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>other::r-x</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>default:user::rwx</expected-output>
        </comparator>
        <comparator>
          <type>RegexpComparator</type>
          <expected-output>^default:user:charlie:rwx\t#effective:rw-$</expected-output>
        </comparator>
        <comparator>
          <type>RegexpComparator</type>
          <expected-output>^default:group::r-x\t#effective:r--$</expected-output>
        </comparator>
        <comparator>
          <type>RegexpComparator</type>
          <expected-output>^default:group:sales:rwx\t#effective:rw-$</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>default:mask::rw-</expected-output>
        </comparator>
        <comparator>
          <type>SubstringComparator</type>
          <expected-output>default:other::r-x</expected-output>
        </comparator>
      </comparators>
    </test>
    <test>
      <description>ls: display extended acl marker</description>
      <test-commands>
        <command>-fs NAMENODE -mkdir -p /dir1/dir2</command>
        <command>-fs NAMENODE -setfacl -m user:charlie:rwx,group::-wx,group:sales:rwx,mask::r-x,default:user:charlie:rwx,default:group::r-x,default:group:sales:rwx,default:mask::rw- /dir1/dir2</command>
        <command>-fs NAMENODE -ls /dir1</command>
      </test-commands>
      <cleanup-commands>
        <command>-fs NAMENODE -rm -R /dir1</command>
      </cleanup-commands>
      <comparators>
        <comparator>
          <type>RegexpComparator</type>
          <expected-output>^drwxr-xr-x\+( )*-( )*USERNAME( )*supergroup( )*0( )*[0-9]{4,}-[0-9]{2,}-[0-9]{2,} [0-9]{2,}:[0-9]{2,}( )*/dir1/dir2</expected-output>
        </comparator>
      </comparators>
    </test>
    <test>
      <description>setfacl: recursive modify entries with mix of files and directories</description>
      <test-commands>
        <command>-fs NAMENODE -mkdir -p /dir1</command>
        <command>-fs NAMENODE -touchz /dir1/file1</command>
        <command>-fs NAMENODE -mkdir -p /dir1/dir2</command>
        <command>-fs NAMENODE -touchz /dir1/dir2/file2</command>
        <command>-fs NAMENODE -setfacl -R -m user:charlie:rwx,default:user:charlie:r-x /dir1</command>
        <command>-fs NAMENODE -getfacl -R /dir1</command>
      </test-commands>
      <cleanup-commands>
        <command>-fs NAMENODE -rm -R /dir1</command>
      </cleanup-commands>
      <comparators>
        <comparator>
          <type>ExactComparator</type>
          <expected-output># file: /dir1#LF## owner: USERNAME#LF## group: supergroup#LF#user::rwx#LF#user:charlie:rwx#LF#group::r-x#LF#mask::rwx#LF#other::r-x#LF#default:user::rwx#LF#default:user:charlie:r-x#LF#default:group::r-x#LF#default:mask::r-x#LF#default:other::r-x#LF##LF## file: /dir1/dir2#LF## owner: USERNAME#LF## group: supergroup#LF#user::rwx#LF#user:charlie:rwx#LF#group::r-x#LF#mask::rwx#LF#other::r-x#LF#default:user::rwx#LF#default:user:charlie:r-x#LF#default:group::r-x#LF#default:mask::r-x#LF#default:other::r-x#LF##LF## file: /dir1/dir2/file2#LF## owner: USERNAME#LF## group: supergroup#LF#user::rw-#LF#user:charlie:rwx#LF#group::r--#LF#mask::rwx#LF#other::r--#LF##LF## file: /dir1/file1#LF## owner: USERNAME#LF## group: supergroup#LF#user::rw-#LF#user:charlie:rwx#LF#group::r--#LF#mask::rwx#LF#other::r--#LF##LF#</expected-output>
        </comparator>
      </comparators>
    </test>
    <test>
      <description>setfacl: recursive remove entries with mix of files and directories</description>
      <test-commands>
        <command>-fs NAMENODE -mkdir -p /dir1</command>
        <command>-fs NAMENODE -touchz /dir1/file1</command>
        <command>-fs NAMENODE -mkdir -p /dir1/dir2</command>
        <command>-fs NAMENODE -touchz /dir1/dir2/file2</command>
        <command>-fs NAMENODE -setfacl -R -m user:bob:rwx,user:charlie:rwx,default:user:bob:rwx,default:user:charlie:r-x /dir1</command>
        <command>-fs NAMENODE -setfacl -R -x user:bob,default:user:bob /dir1</command>
        <command>-fs NAMENODE -getfacl -R /dir1</command>
      </test-commands>
      <cleanup-commands>
        <command>-fs NAMENODE -rm -R /dir1</command>
      </cleanup-commands>
      <comparators>
        <comparator>
          <type>ExactComparator</type>
          <expected-output># file: /dir1#LF## owner: USERNAME#LF## group: supergroup#LF#user::rwx#LF#user:charlie:rwx#LF#group::r-x#LF#mask::rwx#LF#other::r-x#LF#default:user::rwx#LF#default:user:charlie:r-x#LF#default:group::r-x#LF#default:mask::r-x#LF#default:other::r-x#LF##LF## file: /dir1/dir2#LF## owner: USERNAME#LF## group: supergroup#LF#user::rwx#LF#user:charlie:rwx#LF#group::r-x#LF#mask::rwx#LF#other::r-x#LF#default:user::rwx#LF#default:user:charlie:r-x#LF#default:group::r-x#LF#default:mask::r-x#LF#default:other::r-x#LF##LF## file: /dir1/dir2/file2#LF## owner: USERNAME#LF## group: supergroup#LF#user::rw-#LF#user:charlie:rwx#LF#group::r--#LF#mask::rwx#LF#other::r--#LF##LF## file: /dir1/file1#LF## owner: USERNAME#LF## group: supergroup#LF#user::rw-#LF#user:charlie:rwx#LF#group::r--#LF#mask::rwx#LF#other::r--#LF##LF#</expected-output>
        </comparator>
      </comparators>
    </test>
    <test>
      <description>setfacl: recursive set with mix of files and directories</description>
      <test-commands>
        <command>-fs NAMENODE -mkdir -p /dir1</command>
        <command>-fs NAMENODE -touchz /dir1/file1</command>
        <command>-fs NAMENODE -mkdir -p /dir1/dir2</command>
        <command>-fs NAMENODE -touchz /dir1/dir2/file2</command>
        <command>-fs NAMENODE -setfacl -R --set user::rwx,user:charlie:rwx,group::r-x,other::r-x,default:user:charlie:r-x /dir1</command>
        <command>-fs NAMENODE -getfacl -R /dir1</command>
      </test-commands>
      <cleanup-commands>
        <command>-fs NAMENODE -rm -R /dir1</command>
      </cleanup-commands>
      <comparators>
        <comparator>
          <type>ExactComparator</type>
          <expected-output># file: /dir1#LF## owner: USERNAME#LF## group: supergroup#LF#user::rwx#LF#user:charlie:rwx#LF#group::r-x#LF#mask::rwx#LF#other::r-x#LF#default:user::rwx#LF#default:user:charlie:r-x#LF#default:group::r-x#LF#default:mask::r-x#LF#default:other::r-x#LF##LF## file: /dir1/dir2#LF## owner: USERNAME#LF## group: supergroup#LF#user::rwx#LF#user:charlie:rwx#LF#group::r-x#LF#mask::rwx#LF#other::r-x#LF#default:user::rwx#LF#default:user:charlie:r-x#LF#default:group::r-x#LF#default:mask::r-x#LF#default:other::r-x#LF##LF## file: /dir1/dir2/file2#LF## owner: USERNAME#LF## group: supergroup#LF#user::rwx#LF#user:charlie:rwx#LF#group::r-x#LF#mask::rwx#LF#other::r-x#LF##LF## file: /dir1/file1#LF## owner: USERNAME#LF## group: supergroup#LF#user::rwx#LF#user:charlie:rwx#LF#group::r-x#LF#mask::rwx#LF#other::r-x#LF##LF#</expected-output>
        </comparator>
      </comparators>
    </test>
    <test>
      <description>copyFromLocal: copying file into a directory with a default ACL</description>
      <test-commands>
        <command>-fs NAMENODE -mkdir /dir1</command>
        <command>-fs NAMENODE -setfacl -m default:user:charlie:rwx /dir1</command>
        <command>-fs NAMENODE -copyFromLocal CLITEST_DATA/data1k /dir1/data1k</command>
        <command>-fs NAMENODE -getfacl /dir1/data1k</command>
      </test-commands>
      <cleanup-commands>
        <command>-fs NAMENODE -rm -R /dir1</command>
      </cleanup-commands>
      <comparators>
        <comparator>
          <type>RegexpComparator</type>
          <expected-output>^# file: /dir1/data1k$</expected-output>
        </comparator>
        <comparator>
          <type>RegexpComparator</type>
          <expected-output>^# owner: USERNAME$</expected-output>
        </comparator>
        <comparator>
          <type>RegexpComparator</type>
          <expected-output>^# group: supergroup$</expected-output>
        </comparator>
        <comparator>
          <type>RegexpComparator</type>
          <expected-output>^user::rw-$</expected-output>
        </comparator>
        <comparator>
          <type>RegexpComparator</type>
          <expected-output>^user:charlie:rwx\t#effective:rw-$</expected-output>
        </comparator>
        <comparator>
          <type>RegexpComparator</type>
          <expected-output>^group::r-x\t#effective:r--$</expected-output>
        </comparator>
        <comparator>
          <type>RegexpComparator</type>
          <expected-output>^mask::rw-$</expected-output>
        </comparator>
        <comparator>
          <type>RegexpComparator</type>
          <expected-output>^other::r--$</expected-output>
        </comparator>
        <comparator>
          <type>RegexpAcrossOutputComparator</type>
          <expected-output>.*(?!default).*</expected-output>
        </comparator>
      </comparators>
    </test>
  </tests>
</configuration>
