<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--
 | Generated by Apache Maven Doxia at 2024-10-22
 | Rendered using Apache Maven Stylus Skin 1.5
-->
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>Apache Hadoop Amazon Web Services support &#x2013; Upgrading S3A to AWS SDK V2</title>
    <style type="text/css" media="all">
      @import url("../../css/maven-base.css");
      @import url("../../css/maven-theme.css");
      @import url("../../css/site.css");
    </style>
    <link rel="stylesheet" href="../../css/print.css" type="text/css" media="print" />
        <meta name="Date-Revision-yyyymmdd" content="20241022" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
                </head>
  <body class="composite">
    <div id="banner">
                        <a href="http://hadoop.apache.org/" id="bannerLeft">
                                        <img src="http://hadoop.apache.org/images/hadoop-logo.jpg" alt="" />
                </a>
                              <a href="http://www.apache.org/" id="bannerRight">
                                        <img src="http://www.apache.org/images/asf_logo_wide.png" alt="" />
                </a>
            <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
            
                                     <div class="xright">            <a href="http://wiki.apache.org/hadoop" class="externalLink">Wiki</a>
            |
                <a href="https://gitbox.apache.org/repos/asf/hadoop.git" class="externalLink">git</a>
              
                                   &nbsp;| Last Published: 2024-10-22
              &nbsp;| Version: 3.5.0-SNAPSHOT
            </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
             
                                                   <h5>General</h5>
                  <ul>
                  <li class="none">
                  <a href="../../../index.html">Overview</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/SingleCluster.html">Single Node Setup</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/ClusterSetup.html">Cluster Setup</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/CommandsManual.html">Commands Reference</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/FileSystemShell.html">FileSystem Shell</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/Compatibility.html">Compatibility Specification</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/DownstreamDev.html">Downstream Developer's Guide</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/AdminCompatibilityGuide.html">Admin Compatibility Guide</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/InterfaceClassification.html">Interface Classification</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/filesystem/index.html">FileSystem Specification</a>
            </li>
          </ul>
                       <h5>Common</h5>
                  <ul>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/CLIMiniCluster.html">CLI Mini Cluster</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/FairCallQueue.html">Fair Call Queue</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/NativeLibraries.html">Native Libraries</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/Superusers.html">Proxy User</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/RackAwareness.html">Rack Awareness</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/SecureMode.html">Secure Mode</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/ServiceLevelAuth.html">Service Level Authorization</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/HttpAuthentication.html">HTTP Authentication</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/CredentialProviderAPI.html">Credential Provider API</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-kms/index.html">Hadoop KMS</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/Tracing.html">Tracing</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/UnixShellGuide.html">Unix Shell Guide</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/registry/index.html">Registry</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/AsyncProfilerServlet.html">Async Profiler</a>
            </li>
          </ul>
                       <h5>HDFS</h5>
                  <ul>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HdfsDesign.html">Architecture</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HdfsUserGuide.html">User Guide</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HDFSCommands.html">Commands Reference</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HDFSHighAvailabilityWithQJM.html">NameNode HA With QJM</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HDFSHighAvailabilityWithNFS.html">NameNode HA With NFS</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/ObserverNameNode.html">Observer NameNode</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/Federation.html">Federation</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/ViewFs.html">ViewFs</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/ViewFsOverloadScheme.html">ViewFsOverloadScheme</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HdfsSnapshots.html">Snapshots</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HdfsEditsViewer.html">Edits Viewer</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HdfsImageViewer.html">Image Viewer</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HdfsPermissionsGuide.html">Permissions and HDFS</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HdfsQuotaAdminGuide.html">Quotas and HDFS</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/LibHdfs.html">libhdfs (C API)</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/WebHDFS.html">WebHDFS (REST API)</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-hdfs-httpfs/index.html">HttpFS</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/ShortCircuitLocalReads.html">Short Circuit Local Reads</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/CentralizedCacheManagement.html">Centralized Cache Management</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HdfsNfsGateway.html">NFS Gateway</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HdfsRollingUpgrade.html">Rolling Upgrade</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/ExtendedAttributes.html">Extended Attributes</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/TransparentEncryption.html">Transparent Encryption</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HdfsMultihoming.html">Multihoming</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/ArchivalStorage.html">Storage Policies</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/MemoryStorage.html">Memory Storage Support</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/SLGUserGuide.html">Synthetic Load Generator</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HDFSErasureCoding.html">Erasure Coding</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HDFSDiskbalancer.html">Disk Balancer</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HdfsUpgradeDomain.html">Upgrade Domain</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HdfsDataNodeAdminGuide.html">DataNode Admin</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs-rbf/HDFSRouterFederation.html">Router Federation</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HdfsProvidedStorage.html">Provided Storage</a>
            </li>
          </ul>
                       <h5>MapReduce</h5>
                  <ul>
                  <li class="none">
                  <a href="../../../hadoop-mapreduce-client/hadoop-mapreduce-client-core/MapReduceTutorial.html">Tutorial</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-mapreduce-client/hadoop-mapreduce-client-core/MapredCommands.html">Commands Reference</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-mapreduce-client/hadoop-mapreduce-client-core/MapReduce_Compatibility_Hadoop1_Hadoop2.html">Compatibility with 1.x</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-mapreduce-client/hadoop-mapreduce-client-core/EncryptedShuffle.html">Encrypted Shuffle</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-mapreduce-client/hadoop-mapreduce-client-core/PluggableShuffleAndPluggableSort.html">Pluggable Shuffle/Sort</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-mapreduce-client/hadoop-mapreduce-client-core/DistributedCacheDeploy.html">Distributed Cache Deploy</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-mapreduce-client/hadoop-mapreduce-client-core/SharedCacheSupport.html">Support for YARN Shared Cache</a>
            </li>
          </ul>
                       <h5>MapReduce REST APIs</h5>
                  <ul>
                  <li class="none">
                  <a href="../../../hadoop-mapreduce-client/hadoop-mapreduce-client-core/MapredAppMasterRest.html">MR Application Master</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-mapreduce-client/hadoop-mapreduce-client-hs/HistoryServerRest.html">MR History Server</a>
            </li>
          </ul>
                       <h5>YARN</h5>
                  <ul>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/YARN.html">Architecture</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/YarnCommands.html">Commands Reference</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/CapacityScheduler.html">Capacity Scheduler</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/FairScheduler.html">Fair Scheduler</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/ResourceManagerRestart.html">ResourceManager Restart</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/ResourceManagerHA.html">ResourceManager HA</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/ResourceModel.html">Resource Model</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/NodeLabel.html">Node Labels</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/NodeAttributes.html">Node Attributes</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/WebApplicationProxy.html">Web Application Proxy</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/TimelineServer.html">Timeline Server</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/TimelineServiceV2.html">Timeline Service V.2</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/WritingYarnApplications.html">Writing YARN Applications</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/YarnApplicationSecurity.html">YARN Application Security</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/NodeManager.html">NodeManager</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/DockerContainers.html">Running Applications in Docker Containers</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/RuncContainers.html">Running Applications in runC Containers</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/NodeManagerCgroups.html">Using CGroups</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/SecureContainer.html">Secure Containers</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/ReservationSystem.html">Reservation System</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/GracefulDecommission.html">Graceful Decommission</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/OpportunisticContainers.html">Opportunistic Containers</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/Federation.html">YARN Federation</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/SharedCache.html">Shared Cache</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/UsingGpus.html">Using GPU</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/UsingFPGA.html">Using FPGA</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/PlacementConstraints.html">Placement Constraints</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/YarnUI2.html">YARN UI2</a>
            </li>
          </ul>
                       <h5>YARN REST APIs</h5>
                  <ul>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/WebServicesIntro.html">Introduction</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/ResourceManagerRest.html">Resource Manager</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/NodeManagerRest.html">Node Manager</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/TimelineServer.html#Timeline_Server_REST_API_v1">Timeline Server</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/TimelineServiceV2.html#Timeline_Service_v.2_REST_API">Timeline Service V.2</a>
            </li>
          </ul>
                       <h5>YARN Service</h5>
                  <ul>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/yarn-service/Overview.html">Overview</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/yarn-service/QuickStart.html">QuickStart</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/yarn-service/Concepts.html">Concepts</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/yarn-service/YarnServiceAPI.html">Yarn Service API</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/yarn-service/ServiceDiscovery.html">Service Discovery</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/yarn-service/SystemServices.html">System Services</a>
            </li>
          </ul>
                       <h5>Hadoop Compatible File Systems</h5>
                  <ul>
                  <li class="none">
                  <a href="../../../hadoop-aliyun/tools/hadoop-aliyun/index.html">Aliyun OSS</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-aws/tools/hadoop-aws/index.html">Amazon S3</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-azure/index.html">Azure Blob Storage</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-azure-datalake/index.html">Azure Data Lake Storage</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-cos/cloud-storage/index.html">Tencent COS</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-huaweicloud/cloud-storage/index.html">Huaweicloud OBS</a>
            </li>
          </ul>
                       <h5>Auth</h5>
                  <ul>
                  <li class="none">
                  <a href="../../../hadoop-auth/index.html">Overview</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-auth/Examples.html">Examples</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-auth/Configuration.html">Configuration</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-auth/BuildingIt.html">Building</a>
            </li>
          </ul>
                       <h5>Tools</h5>
                  <ul>
                  <li class="none">
                  <a href="../../../hadoop-streaming/HadoopStreaming.html">Hadoop Streaming</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-archives/HadoopArchives.html">Hadoop Archives</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-archive-logs/HadoopArchiveLogs.html">Hadoop Archive Logs</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-distcp/DistCp.html">DistCp</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-federation-balance/HDFSFederationBalance.html">HDFS Federation Balance</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-gridmix/GridMix.html">GridMix</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-rumen/Rumen.html">Rumen</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-resourceestimator/ResourceEstimator.html">Resource Estimator Service</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-sls/SchedulerLoadSimulator.html">Scheduler Load Simulator</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/Benchmarking.html">Hadoop Benchmarking</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-dynamometer/Dynamometer.html">Dynamometer</a>
            </li>
          </ul>
                       <h5>Reference</h5>
                  <ul>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/release/">Changelog and Release Notes</a>
            </li>
                  <li class="none">
                  <a href="../../../api/index.html">Java API docs</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/UnixShellAPI.html">Unix Shell API</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/Metrics.html">Metrics</a>
            </li>
          </ul>
                       <h5>Configuration</h5>
                  <ul>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/core-default.xml">core-default.xml</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/hdfs-default.xml">hdfs-default.xml</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs-rbf/hdfs-rbf-default.xml">hdfs-rbf-default.xml</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-mapreduce-client/hadoop-mapreduce-client-core/mapred-default.xml">mapred-default.xml</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-common/yarn-default.xml">yarn-default.xml</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-kms/kms-default.html">kms-default.xml</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-hdfs-httpfs/httpfs-default.html">httpfs-default.xml</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/DeprecatedProperties.html">Deprecated Properties</a>
            </li>
          </ul>
                                 <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
          <img alt="Built by Maven" src="../../images/logos/maven-feather.png"/>
        </a>
                       
                               </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        <!---
  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

   http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License. See accompanying LICENSE file.
-->
<h1>Upgrading S3A to AWS SDK V2</h1>
<p>This document explains the upcoming work for upgrading S3A to AWS SDK V2. This work is tracked in <a class="externalLink" href="https://issues.apache.org/jira/browse/HADOOP-18073">HADOOP-18073</a>.</p><section>
<h2><a name="Why_the_upgrade.3F"></a>Why the upgrade?</h2>
<ul>

<li>Moving to SDK V2 will provide performance benefits. For example, the <a class="externalLink" href="https://aws.amazon.com/blogs/developer/introducing-amazon-s3-transfer-manager-in-the-aws-sdk-for-java-2-x/">transfer manager for SDK V2</a> is built using java bindings of the AWS Common Runtime S3 client (<a class="externalLink" href="https://github.com/awslabs/aws-crt-java">https://github.com/awslabs/aws-crt-java</a>) (CRT). CRT is a set of packages written in C, designed for maximising performance when interacting with AWS services such as S3.</li>
<li>The V1 SDK is essentially in maintenance mode.</li>
<li>New features such as <a class="externalLink" href="https://aws.amazon.com/blogs/aws/new-additional-checksum-algorithms-for-amazon-s3/">additional checksum algorithms</a> which S3A will benefit from are not available in SDK V1.</li>
</ul></section><section>
<h2><a name="What.E2.80.99s_changing.3F"></a>What&#x2019;s changing?</h2>
<p>The <a class="externalLink" href="https://github.com/aws/aws-sdk-java-v2">SDK V2</a> for S3 is very different from <a class="externalLink" href="https://github.com/aws/aws-sdk-java">SDK V1</a>, and brings breaking changes for S3A. A complete list of the changes can be found in the <a class="externalLink" href="https://github.com/aws/aws-sdk-java-v2/blob/master/docs/LaunchChangelog.md#41-s3-changes">Changelog</a>.</p></section><section>
<h2><a name="Packaging:_aws-java-sdk-bundle-1.12.x.jar_becomes_bundle-2.x.y.jar"></a>Packaging: <code>aws-java-sdk-bundle-1.12.x.jar</code> becomes <code>bundle-2.x.y.jar</code></h2>
<p>As the module name is lost, in hadoop releases a large JAR file with the name &#x201c;bundle&#x201d; is now part of the distribution. This is the AWS V2 SDK shaded artifact.</p>
<p>The new and old SDKs can co-exist; the only place that the hadoop code may still use the original SDK is when a non-standard V1 AWS credential provider is declared.</p>
<p>Any deployment of the S3A connector must include this JAR or the subset of non-shaded aws- JARs needed for communication with S3 and any other services used. As before: the exact set of dependencies used by the S3A connector is neither defined nor comes with any commitments of stability or compatibility of dependent libraries.</p></section><section>
<h2><a name="Credential_Provider_changes_and_migration"></a>Credential Provider changes and migration</h2>
<ul>

<li>Interface change: <a class="externalLink" href="https://github.com/aws/aws-sdk-java/blob/master/aws-java-sdk-core/src/main/java/com/amazonaws/auth/AWSCredentialsProvider.java">com.amazonaws.auth.AWSCredentialsProvider</a> has been replaced by <a class="externalLink" href="https://github.com/aws/aws-sdk-java-v2/blob/master/core/auth/src/main/java/software/amazon/awssdk/auth/credentials/AwsCredentialsProvider.java">software.amazon.awssdk.auth.credentials.AwsCredentialsProvider</a>.</li>
<li>Credential provider class changes: the package and class names of credential providers have changed.</li>
</ul>
<p>The change in interface will mean that custom credential providers will need to be updated to now implement <code>software.amazon.awssdk.auth.credentials.AwsCredentialsProvider</code> instead of <code>com.amazonaws.auth.AWSCredentialsProvider</code>.</p>
<p><a class="externalLink" href="https://issues.apache.org/jira/browse/HADOOP-18980">HADOOP-18980</a> introduces extended version of the credential provider remapping. <code>fs.s3a.aws.credentials.provider.mapping</code> can be used to list comma-separated key-value pairs of mapped credential providers that are separated by equal operator (=). The key can be used by <code>fs.s3a.aws.credentials.provider</code> or <code>fs.s3a.assumed.role.credentials.provider</code> configs, and the key will be translated into the specified value of credential provider class based on the key-value pair provided by the config <code>fs.s3a.aws.credentials.provider.mapping</code>.</p>
<p>For example, if <code>fs.s3a.aws.credentials.provider.mapping</code> is set with value:</p>

<div class="source">
<div class="source">
<pre>&lt;property&gt;
  &lt;name&gt;fs.s3a.aws.credentials.provider.mapping&lt;/name&gt;
  &lt;vale&gt;
    com.amazonaws.auth.AnonymousAWSCredentials=org.apache.hadoop.fs.s3a.AnonymousAWSCredentialsProvider,
    com.amazonaws.auth.EC2ContainerCredentialsProviderWrapper=org.apache.hadoop.fs.s3a.auth.IAMInstanceCredentialsProvider,
    com.amazonaws.auth.InstanceProfileCredentialsProvider=org.apache.hadoop.fs.s3a.auth.IAMInstanceCredentialsProvider
  &lt;/vale&gt;
&lt;/property&gt;
</pre></div></div>

<p>and if <code>fs.s3a.aws.credentials.provider</code> is set with:</p>

<div class="source">
<div class="source">
<pre>&lt;property&gt;
  &lt;name&gt;fs.s3a.aws.credentials.provider&lt;/name&gt;
  &lt;vale&gt;com.amazonaws.auth.AnonymousAWSCredentials&lt;/vale&gt;
&lt;/property&gt;
</pre></div></div>

<p><code>com.amazonaws.auth.AnonymousAWSCredentials</code> will be internally remapped to <code>org.apache.hadoop.fs.s3a.AnonymousAWSCredentialsProvider</code> by S3A while preparing the AWS credential provider list.</p>
<p>Similarly, if <code>fs.s3a.assumed.role.credentials.provider</code> is set with:</p>

<div class="source">
<div class="source">
<pre>&lt;property&gt;
  &lt;name&gt;fs.s3a.assumed.role.credentials.provider&lt;/name&gt;
  &lt;vale&gt;com.amazonaws.auth.InstanceProfileCredentialsProvider&lt;/vale&gt;
&lt;/property&gt;
</pre></div></div>

<p><code>com.amazonaws.auth.InstanceProfileCredentialsProvider</code> will be internally remapped to <code>org.apache.hadoop.fs.s3a.auth.IAMInstanceCredentialsProvider</code> by S3A while preparing the assumed role AWS credential provider list.</p><section>
<h3><a name="Original_V1_AWSCredentialsProvider_interface"></a>Original V1 <code>AWSCredentialsProvider</code> interface</h3>
<p>Note how the interface begins with the capitalized &#x201c;AWS&#x201d; acronym. The V2 interface starts with &#x201c;Aws&#x201d;. This is a very subtle change for developers to spot. Compilers <i>will</i> detect and report the type mismatch.</p>

<div class="source">
<div class="source">
<pre>package com.amazonaws.auth;

public interface AWSCredentialsProvider {

    public AWSCredentials getCredentials();

    public void refresh();

}

</pre></div></div>

<p>The interface binding also supported a factory method, <code>AWSCredentialsProvider instance()</code> which, if available, would be invoked in preference to using any constructor.</p>
<p>If the interface implemented <code>Closeable</code> or <code>AutoCloseable</code>, these would be invoked when the provider chain was being shut down.</p></section><section>
<h3><a name="New_V2_AwsCredentialsProvider_interface"></a>New V2 <code>AwsCredentialsProvider</code> interface</h3>

<div class="source">
<div class="source">
<pre>package software.amazon.awssdk.auth.credentials;

public interface AwsCredentialsProvider {

  AwsCredentials resolveCredentials();

}
</pre></div></div>

<ol style="list-style-type: decimal">

<li>There is no <code>refresh()</code> method any more.</li>
<li><code>getCredentials()</code> has become <code>resolveCredentials()</code>.</li>
<li>There is now the expectation in the SDK that credential resolution/lookup etc will be performed in <code>resolveCredentials()</code>.</li>
<li>If the interface implements <code>Closeable</code> or <code>AutoCloseable</code>, these will be invoked when the provider chain is being shut down.</li>
<li>A static method <code>create()</code> which returns an <code>AwsCredentialsProvider</code> or subclass; this will be used in preference to a constructor</li>
</ol></section><section>
<h3><a name="S3A_AWSCredentialProviderList_is_now_a_V2_credential_provider"></a>S3A <code>AWSCredentialProviderList</code> is now a V2 credential provider</h3>
<p>The class <code>org.apache.hadoop.fs.s3a.AWSCredentialProviderList</code> has moved from being a V1 to a V2 credential provider; even if an instance can be created with existing code, the V1 methods will not resolve:</p>

<div class="source">
<div class="source">
<pre>java.lang.NoSuchMethodError: org.apache.hadoop.fs.s3a.AWSCredentialProviderList.getCredentials()Lcom/amazonaws/auth/AWSCredentials;
  at org.apache.hadoop.fs.store.diag.S3ADiagnosticsInfo.validateFilesystem(S3ADiagnosticsInfo.java:903)
</pre></div></div>
</section><section>
<h3><a name="Migration_of_Credential_Providers_listed_in_fs.s3a.aws.credentials.provider"></a>Migration of Credential Providers listed in <code>fs.s3a.aws.credentials.provider</code></h3>
<p>Before: <code>fs.s3a.aws.credentials.provider</code> took a list of v1 credential providers, This took a list containing 1. V1 credential providers implemented in the <code>hadoop-aws</code> module. 2. V1 credential providers implemented in the <code>aws-sdk-bundle</code> library. 3. Custom V1 credential providers placed onto the classpath. 4. Custom subclasses of hadoop-aws credential providers.</p>
<p>And here is how they change 1. All <code>hadoop-aws</code> credential providers migrated to V2. 2. Well-known <code>aws-sdk-bundle</code> credential providers <i>automatically remapped</i> to their V2 equivalents. 3. Custom v1 providers supported if the original <code>aws-sdk-bundle</code> JAR is on the classpath. 4. Custom subclasses of hadoop-aws credential providers need manual migration.</p>
<p>Because of (1) and (2), As result, standard <code>fs.s3a.aws.credentials.provider</code> configurations should seamlessly upgrade. This also means that the same provider list, if restricted to those classes, will work across versions.</p></section><section>
<h3><a name="hadoop-aws_credential_providers_migration_to_V2"></a><code>hadoop-aws</code> credential providers migration to V2</h3>
<p>All the fs.s3a credential providers have the same name and functionality as before.</p>
<table border="0" class="bodyTable">
<thead>

<tr class="a">
<th> Hadoop module credential provider                              </th>
<th> Authentication Mechanism                         </th></tr>
</thead><tbody>

<tr class="b">
<td> <code>org.apache.hadoop.fs.s3a.TemporaryAWSCredentialsProvider</code>     </td>
<td> Session Credentials in configuration             </td></tr>
<tr class="a">
<td> <code>org.apache.hadoop.fs.s3a.SimpleAWSCredentialsProvider</code>        </td>
<td> Simple name/secret credentials in configuration  </td></tr>
<tr class="b">
<td> <code>org.apache.hadoop.fs.s3a.AnonymousAWSCredentialsProvider</code>     </td>
<td> Anonymous Login                                  </td></tr>
<tr class="a">
<td> <code>org.apache.hadoop.fs.s3a.auth.AssumedRoleCredentialProvider</code>  </td>
<td> <a href="./assumed_roles.html">Assumed Role credentials</a> </td></tr>
<tr class="b">
<td> <code>org.apache.hadoop.fs.s3a.auth.IAMInstanceCredentialsProvider</code> </td>
<td> EC2/k8s instance credentials                     </td></tr>
</tbody>
</table></section><section>
<h3><a name="Automatic_aws-sdk-bundle_credential_provider_remapping"></a>Automatic <code>aws-sdk-bundle</code> credential provider remapping</h3>
<p>The commonly-used set of V1 credential providers are automatically remapped to V2 equivalents.</p>
<table border="0" class="bodyTable">
<thead>

<tr class="a">
<th> V1 Credential Provider                                      </th>
<th> Remapped V2 substitute                                                           </th></tr>
</thead><tbody>

<tr class="b">
<td> <code>com.amazonaws.auth.AnonymousAWSCredentials</code>                </td>
<td> <code>org.apache.hadoop.fs.s3a.AnonymousAWSCredentialsProvider</code>                       </td></tr>
<tr class="a">
<td> <code>com.amazonaws.auth.EnvironmentVariableCredentialsProvider</code> </td>
<td> <code>software.amazon.awssdk.auth.credentials.EnvironmentVariableCredentialsProvider</code> </td></tr>
<tr class="b">
<td> <code>com.amazonaws.auth.EC2ContainerCredentialsProviderWrapper</code> </td>
<td> <code>org.apache.hadoop.fs.s3a.auth.IAMInstanceCredentialsProvider</code>                   </td></tr>
<tr class="a">
<td> <code>com.amazonaws.auth.InstanceProfileCredentialsProvider</code>     </td>
<td> <code>org.apache.hadoop.fs.s3a.auth.IAMInstanceCredentialsProvider</code>                   </td></tr>
<tr class="b">
<td> <code>com.amazonaws.auth.profile.ProfileCredentialsProvider</code>     </td>
<td> <code>software.amazon.awssdk.auth.credentials.ProfileCredentialsProvider</code>             </td></tr>
</tbody>
</table>
<p>There are still a number of troublespots here:</p><section>
<h4><a name="Less_widely_usedcom.amazonaws.auth._AWS_providers"></a>Less widely used<code>com.amazonaws.auth.</code> AWS providers</h4>
<p>There should be equivalents in the new SDK, but as well as being renamed they are likely to have moved different factory/builder mechanisms. Identify the changed classes and use their names in the <code>fs.s3a.aws.credentials.provider</code> option.</p>
<p>If a V2 equivalent is not found; provided the V1 SDK is added to the classpath, it should still be possible to use the existing classes.</p></section><section>
<h4><a name="Private.2Fthird-party_credential_providers"></a>Private/third-party credential providers</h4>
<p>Provided the V1 SDK is added to the classpath, it should still be possible to use the existing classes.</p>
<p>Adding a V2 equivalent is the recommended long-term solution.</p></section><section>
<h4><a name="Custom_subclasses_of_the_Hadoop_credential_providers"></a>Custom subclasses of the Hadoop credential providers</h4>
<p>Because all the standard hadoop credential providers have been upgraded, any subclasses of these are not going to link or work.</p>
<p>These will need to be manually migrated to being V2 Credential providers.</p></section></section></section><section>
<h2><a name="Source_code.2Fbinary_integration_changes"></a>Source code/binary integration changes</h2>
<p>The major changes and how this affects S3A are listed below.</p><section>
<h3><a name="SDK_API_Package_Change"></a>SDK API Package Change</h3>
<ul>

<li>Package names have changed, all classes in SDK V2 are under <code>software.amazon.awssdk</code>, SDK V1 classes were under <code>com.amazonaws</code>.</li>
<li>There is no interoperability between the old and new classes.</li>
<li>All classnames are different, often in very subtle ways. It is possible to use both in the same class, as is done in the package <code>org.apache.hadoop.fs.s3a.adapter</code>.</li>
<li>All the core message classes are now automatically generated from a JSON protocol description.</li>
<li>All getter methods have been renamed.</li>
<li>All classes are constructed via builder methods</li>
<li>Message classes are no longer Java <code>Serializable</code>.</li>
</ul>
<p>Most of these changes simply create what will feel to be gratuitous migration effort; the removable of the <code>Serializable</code> nature from all message response classes can potentially break applications -such as anything passing them between Spark workers. See AWS SDK V2 issue <a class="externalLink" href="https://github.com/aws/aws-sdk-java-v2/issues/82">Simplify Modeled Message Marshalling #82</a>, note that it was filed in 2017, then implement your own workaround pending that issue being resolved.</p></section><section>
<h3><a name="Compilation.2FLinkage_Errors"></a>Compilation/Linkage Errors</h3>
<p>Any code making use of V1 sdk classes will fail if they * Expect the V1 sdk classes to be on the classpath when <code>hadoop-aws</code> is declared as a dependency * Use V1-SDK-compatible methods previously exported by the <code>S3AFileSystem</code> class and associated classes. * Try to pass s3a classes to V1 SDK classes (e.g. credential providers).</p>
<p>The sole solution to these problems is &#x201c;move to the V2 SDK&#x201d;.</p>
<p>Some <code>S3AUtils</code> methods are deleted</p>

<div class="source">
<div class="source">
<pre>cannot find symbol
[ERROR]   symbol:   method createAwsConf(org.apache.hadoop.conf.Configuration,java.lang.String)
[ERROR]   location: class org.apache.hadoop.fs.s3a.S3AUtils
</pre></div></div>

<p>The signature and superclass of <code>AWSCredentialProviderList</code> has changed, which can surface in different ways</p>
<p>Signature mismatch</p>

<div class="source">
<div class="source">
<pre> cannot find symbol
[ERROR]   symbol:   method getCredentials()
[ERROR]   location: variable credentials of type org.apache.hadoop.fs.s3a.AWSCredentialProviderList
</pre></div></div>

<p>It is no longer a V1 credential provider, cannot be used to pass credentials to a V1 SDK class</p>

<div class="source">
<div class="source">
<pre>incompatible types: org.apache.hadoop.fs.s3a.AWSCredentialProviderList cannot be converted to com.amazonaws.auth.AWSCredentialsProvider
</pre></div></div>
</section><section>
<h3><a name="AmazonS3_replaced_by_S3Client.3B_factory_and_accessor_changed."></a><code>AmazonS3</code> replaced by <code>S3Client</code>; factory and accessor changed.</h3>
<p>The V1 s3 client class <code>com.amazonaws.services.s3.AmazonS3</code> has been superseded by <code>software.amazon.awssdk.services.s3.S3Client</code></p>
<p>The <code>S3ClientFactory</code> interface has been replaced by one that creates a V2 <code>S3Client</code>. * Custom implementations will need to be updated. * The <code>InconsistentS3ClientFactory</code> class has been deleted.</p></section><section>
<h3><a name="S3AFileSystem_method_changes:_S3AInternals."></a><code>S3AFileSystem</code> method changes: <code>S3AInternals</code>.</h3>
<p>The low-level s3 operations/client accessors have been moved into a new interface, <code>org.apache.hadoop.fs.s3a.S3AInternals</code>, which must be accessed via the <code>S3AFileSystem.getS3AInternals()</code> method. They have also been updated to return V2 SDK classes.</p>

<div class="source">
<div class="source">
<pre>@InterfaceStability.Unstable
@InterfaceAudience.LimitedPrivate(&quot;testing/diagnostics&quot;)
public interface S3AInternals {
  S3Client getAmazonS3V2Client(String reason);

  S3AStore getStore();
  @Retries.RetryTranslated
  @AuditEntryPoint
  String getBucketLocation() throws IOException;

  @AuditEntryPoint
  @Retries.RetryTranslated
  String getBucketLocation(String bucketName) throws IOException;

  @AuditEntryPoint
  @Retries.RetryTranslated
  HeadObjectResponse getObjectMetadata(Path path) throws IOException;

  AWSCredentialProviderList shareCredentials(final String purpose);

  @AuditEntryPoint
  @Retries.RetryTranslated
  HeadBucketResponse getBucketMetadata() throws IOException;

  boolean isMultipartCopyEnabled();

  @AuditEntryPoint
  @Retries.RetryTranslated
  long abortMultipartUploads(Path path) throws IOException;
}
</pre></div></div>
<section>
<h4><a name="S3AFileSystem.getAmazonS3ClientForTesting.28String.29_moved_and_return_type_changed"></a><code>S3AFileSystem.getAmazonS3ClientForTesting(String)</code> moved and return type changed</h4>
<p>The <code>S3AFileSystem.getAmazonS3ClientForTesting()</code> method has been been deleted.</p>
<p>Compilation</p>

<div class="source">
<div class="source">
<pre>cannot find symbol
[ERROR]   symbol:   method getAmazonS3ClientForTesting(java.lang.String)
[ERROR]   location: variable fs of type org.apache.hadoop.fs.s3a.S3AFileSystem
</pre></div></div>

<p>It has been replaced by an <code>S3AInternals</code> equivalent which returns the V2 <code>S3Client</code> of the filesystem instance.</p>

<div class="source">
<div class="source">
<pre>((S3AFilesystem)fs).getAmazonS3ClientForTesting(&quot;testing&quot;)
</pre></div></div>

<div class="source">
<div class="source">
<pre>((S3AFilesystem)fs).getS3AInternals().getAmazonS3Client(&quot;testing&quot;)
</pre></div></div>
<section>
<h5><a name="S3AFileSystem.getObjectMetadata.28Path_path.29__moved_to_S3AInternals.3B_return_type_changed"></a><code>S3AFileSystem.getObjectMetadata(Path path)</code>  moved to <code>S3AInternals</code>; return type changed</h5>
<p>The <code>getObjectMetadata(Path)</code> call has been moved to the <code>S3AInternals</code> interface and an instance of the <code>software.amazon.awssdk.services.s3.model.HeadObjectResponse</code> class returned. The original <code>S3AFileSystem</code> method has been deleted</p>
<p>Before:</p>

<div class="source">
<div class="source">
<pre>((S3AFilesystem)fs).getObjectMetadata(path)
</pre></div></div>

<p>After:</p>

<div class="source">
<div class="source">
<pre>((S3AFilesystem)fs).getS3AInternals().getObjectMetadata(path)
</pre></div></div>
</section><section>
<h5><a name="AWSCredentialProviderList_shareCredentials.28String.29_moved_to_S3AInternals"></a><code>AWSCredentialProviderList shareCredentials(String)</code> moved to <code>S3AInternals</code></h5>
<p>The operation to share a reference-counted access to the AWS credentials used by the S3A FS has been moved to <code>S3AInternals</code>.</p>
<p>This is very much an implementation method, used to allow extension modules to share an authentication chain into other AWS SDK client services (dynamoDB, etc.).</p></section></section></section><section>
<h3><a name="Delegation_Tokens"></a>Delegation Tokens</h3>
<ol style="list-style-type: decimal">

<li>Custom credential providers used in delegation token binding classes will need to be updated</li>
<li>The return type from delegation token binding has changed to support more class instances being returned in the future.</li>
</ol>
<p><code>AWSCredentialProviderList</code> has been upgraded to the V2 API. * It still retains a <code>refresh()</code> method but this is now a deprecated no-op. * It is still <code>Closeable</code>; its <code>close()</code> method iterates through all entries in the list; if they are <code>Closeable</code> or <code>AutoCloseable</code> then their <code>close()</code> method is invoked. * Accordingly, providers may still perform background refreshes in separate threads; the S3A client will close its provider list when the filesystem itself is closed.</p></section><section>
<h3><a name="Signers"></a>Signers</h3>
<p>Interface change: <a class="externalLink" href="https://github.com/aws/aws-sdk-java/blob/master/aws-java-sdk-core/src/main/java/com/amazonaws/auth/Signer.java">com.amazonaws.auth.Signer</a> has been replaced by <a class="externalLink" href="https://github.com/aws/aws-sdk-java-v2/blob/master/core/sdk-core/src/main/java/software/amazon/awssdk/core/signer/Signer.java">software.amazon.awssdk.core.signer.Signer</a>.</p>
<p>The change in signers will mean the custom signers will need to be updated to implement the new interface.</p>
<p>There is no support to assist in this migration.</p></section><section>
<h3><a name="S3A_Auditing_Extensions."></a>S3A Auditing Extensions.</h3>
<p>The callbacks from the SDK have all changed, as has the interface <code>org.apache.hadoop.fs.s3a.audit.AWSAuditEventCallbacks</code></p>
<p>Examine the interface and associated implementations to see how to migrate.</p>
<p>The option <code>fs.s3a.audit.request.handlers</code> to declare a list of v1 SDK <code>com.amazonaws.handlers.RequestHandler2</code> implementations to include in the AWS request chain is no longer supported: a warning is printed and the value ignored.</p>
<p>The V2 SDK equivalent, classes implementing <code>software.amazon.awssdk.core.interceptor.ExecutionInterceptor</code> can be declared in the configuration option <code>fs.s3a.audit.execution.interceptors</code>.</p></section></section>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
        &#169;            2008-2024
              Apache Software Foundation
            
                          - <a href="http://maven.apache.org/privacy-policy.html">Privacy Policy</a>.
        Apache Maven, Maven, Apache, the Apache feather logo, and the Apache Maven project logos are trademarks of The Apache Software Foundation.
      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
