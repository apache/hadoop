<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--
 | Generated by Apache Maven Doxia at 2024-10-22
 | Rendered using Apache Maven Stylus Skin 1.5
-->
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>Apache Hadoop Amazon Web Services support &#x2013; Hadoop-AWS module: Integration with Amazon Web Services</title>
    <style type="text/css" media="all">
      @import url("../../css/maven-base.css");
      @import url("../../css/maven-theme.css");
      @import url("../../css/site.css");
    </style>
    <link rel="stylesheet" href="../../css/print.css" type="text/css" media="print" />
        <meta name="Date-Revision-yyyymmdd" content="20241022" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
                </head>
  <body class="composite">
    <div id="banner">
                        <a href="http://hadoop.apache.org/" id="bannerLeft">
                                        <img src="http://hadoop.apache.org/images/hadoop-logo.jpg" alt="" />
                </a>
                              <a href="http://www.apache.org/" id="bannerRight">
                                        <img src="http://www.apache.org/images/asf_logo_wide.png" alt="" />
                </a>
            <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
            
                                     <div class="xright">            <a href="http://wiki.apache.org/hadoop" class="externalLink">Wiki</a>
            |
                <a href="https://gitbox.apache.org/repos/asf/hadoop.git" class="externalLink">git</a>
              
                                   &nbsp;| Last Published: 2024-10-22
              &nbsp;| Version: 3.5.0-SNAPSHOT
            </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
             
                                                   <h5>General</h5>
                  <ul>
                  <li class="none">
                  <a href="../../../index.html">Overview</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/SingleCluster.html">Single Node Setup</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/ClusterSetup.html">Cluster Setup</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/CommandsManual.html">Commands Reference</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/FileSystemShell.html">FileSystem Shell</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/Compatibility.html">Compatibility Specification</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/DownstreamDev.html">Downstream Developer's Guide</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/AdminCompatibilityGuide.html">Admin Compatibility Guide</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/InterfaceClassification.html">Interface Classification</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/filesystem/index.html">FileSystem Specification</a>
            </li>
          </ul>
                       <h5>Common</h5>
                  <ul>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/CLIMiniCluster.html">CLI Mini Cluster</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/FairCallQueue.html">Fair Call Queue</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/NativeLibraries.html">Native Libraries</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/Superusers.html">Proxy User</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/RackAwareness.html">Rack Awareness</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/SecureMode.html">Secure Mode</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/ServiceLevelAuth.html">Service Level Authorization</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/HttpAuthentication.html">HTTP Authentication</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/CredentialProviderAPI.html">Credential Provider API</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-kms/index.html">Hadoop KMS</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/Tracing.html">Tracing</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/UnixShellGuide.html">Unix Shell Guide</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/registry/index.html">Registry</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/AsyncProfilerServlet.html">Async Profiler</a>
            </li>
          </ul>
                       <h5>HDFS</h5>
                  <ul>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HdfsDesign.html">Architecture</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HdfsUserGuide.html">User Guide</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HDFSCommands.html">Commands Reference</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HDFSHighAvailabilityWithQJM.html">NameNode HA With QJM</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HDFSHighAvailabilityWithNFS.html">NameNode HA With NFS</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/ObserverNameNode.html">Observer NameNode</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/Federation.html">Federation</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/ViewFs.html">ViewFs</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/ViewFsOverloadScheme.html">ViewFsOverloadScheme</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HdfsSnapshots.html">Snapshots</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HdfsEditsViewer.html">Edits Viewer</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HdfsImageViewer.html">Image Viewer</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HdfsPermissionsGuide.html">Permissions and HDFS</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HdfsQuotaAdminGuide.html">Quotas and HDFS</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/LibHdfs.html">libhdfs (C API)</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/WebHDFS.html">WebHDFS (REST API)</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-hdfs-httpfs/index.html">HttpFS</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/ShortCircuitLocalReads.html">Short Circuit Local Reads</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/CentralizedCacheManagement.html">Centralized Cache Management</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HdfsNfsGateway.html">NFS Gateway</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HdfsRollingUpgrade.html">Rolling Upgrade</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/ExtendedAttributes.html">Extended Attributes</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/TransparentEncryption.html">Transparent Encryption</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HdfsMultihoming.html">Multihoming</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/ArchivalStorage.html">Storage Policies</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/MemoryStorage.html">Memory Storage Support</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/SLGUserGuide.html">Synthetic Load Generator</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HDFSErasureCoding.html">Erasure Coding</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HDFSDiskbalancer.html">Disk Balancer</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HdfsUpgradeDomain.html">Upgrade Domain</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HdfsDataNodeAdminGuide.html">DataNode Admin</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs-rbf/HDFSRouterFederation.html">Router Federation</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/HdfsProvidedStorage.html">Provided Storage</a>
            </li>
          </ul>
                       <h5>MapReduce</h5>
                  <ul>
                  <li class="none">
                  <a href="../../../hadoop-mapreduce-client/hadoop-mapreduce-client-core/MapReduceTutorial.html">Tutorial</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-mapreduce-client/hadoop-mapreduce-client-core/MapredCommands.html">Commands Reference</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-mapreduce-client/hadoop-mapreduce-client-core/MapReduce_Compatibility_Hadoop1_Hadoop2.html">Compatibility with 1.x</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-mapreduce-client/hadoop-mapreduce-client-core/EncryptedShuffle.html">Encrypted Shuffle</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-mapreduce-client/hadoop-mapreduce-client-core/PluggableShuffleAndPluggableSort.html">Pluggable Shuffle/Sort</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-mapreduce-client/hadoop-mapreduce-client-core/DistributedCacheDeploy.html">Distributed Cache Deploy</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-mapreduce-client/hadoop-mapreduce-client-core/SharedCacheSupport.html">Support for YARN Shared Cache</a>
            </li>
          </ul>
                       <h5>MapReduce REST APIs</h5>
                  <ul>
                  <li class="none">
                  <a href="../../../hadoop-mapreduce-client/hadoop-mapreduce-client-core/MapredAppMasterRest.html">MR Application Master</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-mapreduce-client/hadoop-mapreduce-client-hs/HistoryServerRest.html">MR History Server</a>
            </li>
          </ul>
                       <h5>YARN</h5>
                  <ul>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/YARN.html">Architecture</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/YarnCommands.html">Commands Reference</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/CapacityScheduler.html">Capacity Scheduler</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/FairScheduler.html">Fair Scheduler</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/ResourceManagerRestart.html">ResourceManager Restart</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/ResourceManagerHA.html">ResourceManager HA</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/ResourceModel.html">Resource Model</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/NodeLabel.html">Node Labels</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/NodeAttributes.html">Node Attributes</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/WebApplicationProxy.html">Web Application Proxy</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/TimelineServer.html">Timeline Server</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/TimelineServiceV2.html">Timeline Service V.2</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/WritingYarnApplications.html">Writing YARN Applications</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/YarnApplicationSecurity.html">YARN Application Security</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/NodeManager.html">NodeManager</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/DockerContainers.html">Running Applications in Docker Containers</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/RuncContainers.html">Running Applications in runC Containers</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/NodeManagerCgroups.html">Using CGroups</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/SecureContainer.html">Secure Containers</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/ReservationSystem.html">Reservation System</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/GracefulDecommission.html">Graceful Decommission</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/OpportunisticContainers.html">Opportunistic Containers</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/Federation.html">YARN Federation</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/SharedCache.html">Shared Cache</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/UsingGpus.html">Using GPU</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/UsingFPGA.html">Using FPGA</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/PlacementConstraints.html">Placement Constraints</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/YarnUI2.html">YARN UI2</a>
            </li>
          </ul>
                       <h5>YARN REST APIs</h5>
                  <ul>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/WebServicesIntro.html">Introduction</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/ResourceManagerRest.html">Resource Manager</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/NodeManagerRest.html">Node Manager</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/TimelineServer.html#Timeline_Server_REST_API_v1">Timeline Server</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/TimelineServiceV2.html#Timeline_Service_v.2_REST_API">Timeline Service V.2</a>
            </li>
          </ul>
                       <h5>YARN Service</h5>
                  <ul>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/yarn-service/Overview.html">Overview</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/yarn-service/QuickStart.html">QuickStart</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/yarn-service/Concepts.html">Concepts</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/yarn-service/YarnServiceAPI.html">Yarn Service API</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/yarn-service/ServiceDiscovery.html">Service Discovery</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-site/yarn-service/SystemServices.html">System Services</a>
            </li>
          </ul>
                       <h5>Hadoop Compatible File Systems</h5>
                  <ul>
                  <li class="none">
                  <a href="../../../hadoop-aliyun/tools/hadoop-aliyun/index.html">Aliyun OSS</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-aws/tools/hadoop-aws/index.html">Amazon S3</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-azure/index.html">Azure Blob Storage</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-azure-datalake/index.html">Azure Data Lake Storage</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-cos/cloud-storage/index.html">Tencent COS</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-huaweicloud/cloud-storage/index.html">Huaweicloud OBS</a>
            </li>
          </ul>
                       <h5>Auth</h5>
                  <ul>
                  <li class="none">
                  <a href="../../../hadoop-auth/index.html">Overview</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-auth/Examples.html">Examples</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-auth/Configuration.html">Configuration</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-auth/BuildingIt.html">Building</a>
            </li>
          </ul>
                       <h5>Tools</h5>
                  <ul>
                  <li class="none">
                  <a href="../../../hadoop-streaming/HadoopStreaming.html">Hadoop Streaming</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-archives/HadoopArchives.html">Hadoop Archives</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-archive-logs/HadoopArchiveLogs.html">Hadoop Archive Logs</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-distcp/DistCp.html">DistCp</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-federation-balance/HDFSFederationBalance.html">HDFS Federation Balance</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-gridmix/GridMix.html">GridMix</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-rumen/Rumen.html">Rumen</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-resourceestimator/ResourceEstimator.html">Resource Estimator Service</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-sls/SchedulerLoadSimulator.html">Scheduler Load Simulator</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/Benchmarking.html">Hadoop Benchmarking</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-dynamometer/Dynamometer.html">Dynamometer</a>
            </li>
          </ul>
                       <h5>Reference</h5>
                  <ul>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/release/">Changelog and Release Notes</a>
            </li>
                  <li class="none">
                  <a href="../../../api/index.html">Java API docs</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/UnixShellAPI.html">Unix Shell API</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/Metrics.html">Metrics</a>
            </li>
          </ul>
                       <h5>Configuration</h5>
                  <ul>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/core-default.xml">core-default.xml</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs/hdfs-default.xml">hdfs-default.xml</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-hdfs-rbf/hdfs-rbf-default.xml">hdfs-rbf-default.xml</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-mapreduce-client/hadoop-mapreduce-client-core/mapred-default.xml">mapred-default.xml</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-yarn/hadoop-yarn-common/yarn-default.xml">yarn-default.xml</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-kms/kms-default.html">kms-default.xml</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-hdfs-httpfs/httpfs-default.html">httpfs-default.xml</a>
            </li>
                  <li class="none">
                  <a href="../../../hadoop-project-dist/hadoop-common/DeprecatedProperties.html">Deprecated Properties</a>
            </li>
          </ul>
                                 <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
          <img alt="Built by Maven" src="../../images/logos/maven-feather.png"/>
        </a>
                       
                               </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        <!---
  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

   http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License. See accompanying LICENSE file.
-->
<h1>Hadoop-AWS module: Integration with Amazon Web Services</h1>
<ul>
<li><a href="#Compatibility"> Compatibility</a>
<ul>
<li><a href="#Directory_Marker_Compatibility"> Directory Marker Compatibility</a></li></ul></li>
<li><a href="#Documents"> Documents</a></li>
<li><a href="#Overview"> Overview</a></li>
<li><a href="#Introducing_the_Hadoop_S3A_client."> Introducing the Hadoop S3A client.</a>
<ul>
<li><a href="#Other_S3_Connectors">Other S3 Connectors</a></li></ul></li>
<li><a href="#Getting_Started"> Getting Started</a></li>
<li><a href="#Warnings"> Warnings</a>
<ul>
<li><a href="#Warning_.231:_Directories_are_mimicked">Warning #1: Directories are mimicked</a></li>
<li><a href="#Warning_.232:_Object_stores_have_different_authorization_models">Warning #2: Object stores have different authorization models</a></li>
<li><a href="#Warning_.234:_Your_AWS_credentials_are_very.2C_very_valuable">Warning #4: Your AWS credentials are very, very valuable</a></li></ul></li>
<li><a href="#Connecting_to_Amazon_S3_or_a_third-party_store">Connecting to Amazon S3 or a third-party store</a></li>
<li><a href="#Authenticating_with_S3"> Authenticating with S3</a></li>
<li><a href="#Storing_secrets_with_Hadoop_Credential_Providers">Storing secrets with Hadoop Credential Providers</a>
<ul>
<li><a href="#Step_1:_Create_a_credential_file">Step 1: Create a credential file</a></li>
<li><a href="#Step_2:_Configure_the_hadoop.security.credential.provider.path_property">Step 2: Configure the hadoop.security.credential.provider.path property</a></li>
<li><a href="#Using_secrets_from_credential_providers">Using secrets from credential providers</a></li></ul></li>
<li><a href="#General_S3A_Client_configuration">General S3A Client configuration</a></li>
<li><a href="#Retry_and_Recovery">Retry and Recovery</a>
<ul>
<li><a href="#Unrecoverable_Problems:_Fail_Fast">Unrecoverable Problems: Fail Fast</a></li>
<li><a href="#Possibly_Recoverable_Problems:_Retry">Possibly Recoverable Problems: Retry</a></li>
<li><a href="#Only_retriable_on_idempotent_operations">Only retriable on idempotent operations</a></li>
<li><a href="#Throttled_requests_from_S3">Throttled requests from S3</a></li></ul></li>
<li><a href="#Handling_Read-During-Overwrite">Handling Read-During-Overwrite</a>
<ul>
<li><a href="#Change_detection_with_S3_Versions.">Change detection with S3 Versions.</a></li>
<li><a href="#Change_Detection_Modes.">Change Detection Modes.</a></li></ul></li>
<li><a href="#Configuring_different_S3_buckets_with_Per-Bucket_Configuration">Configuring different S3 buckets with Per-Bucket Configuration</a>
<ul>
<li><a href="#a"></a></li></ul></li>
<li><a href="#Requester_Pays_buckets">Requester Pays buckets</a></li>
<li><a href="#Storage_Classes">Storage Classes</a></li>
<li><a href="#Configuring_S3A_for_S3_on_Outposts">Configuring S3A for S3 on Outposts</a></li>
<li><a href="#How_S3A_writes_data_to_S3">How S3A writes data to S3</a>
<ul>
<li><a href="#Buffering_upload_data_on_disk_fs.s3a.fast.upload.buffer.3Ddisk">Buffering upload data on disk fs.s3a.fast.upload.buffer=disk</a></li>
<li><a href="#Buffering_upload_data_in_ByteBuffers:_fs.s3a.fast.upload.buffer.3Dbytebuffer">Buffering upload data in ByteBuffers: fs.s3a.fast.upload.buffer=bytebuffer</a></li>
<li><a href="#Buffering_upload_data_in_byte_arrays:_fs.s3a.fast.upload.buffer.3Darray">Buffering upload data in byte arrays: fs.s3a.fast.upload.buffer=array</a></li>
<li><a href="#Upload_Thread_Tuning">Upload Thread Tuning</a></li>
<li><a href="#Cleaning_up_after_partial_Upload_Failures">Cleaning up after partial Upload Failures</a></li>
<li><a href="#S3A_.E2.80.9Cfadvise.E2.80.9D_input_policy_support">S3A &#x201c;fadvise&#x201d; input policy support</a></li></ul></li>
<li><a href="#Metrics">Metrics</a></li>
<li><a href="#Other_Topics"> Other Topics</a>
<ul>
<li><a href="#Copying_Data_with_distcp"> Copying Data with distcp</a></li>
<li><a href="#Advanced_-_Custom_Signers"> Advanced - Custom Signers</a></li></ul></li></ul>
<section>
<h2><a name="Compatibility"></a><a name="compatibility"></a> Compatibility</h2><section>
<h3><a name="Directory_Marker_Compatibility"></a><a name="directory-marker-compatibility"></a> Directory Marker Compatibility</h3>
<p>This release does not delete directory markers when creating files or directories underneath. This is incompatible with versions of the Hadoop S3A client released before 2021.</p>
<p>Consult <a href="directory_markers.html">Controlling the S3A Directory Marker Behavior</a> for full details.</p></section></section><section>
<h2><a name="Documents"></a><a name="documents"></a> Documents</h2>
<ul>

<li><a href="./connecting.html">Connecting</a></li>
<li><a href="./encryption.html">Encryption</a></li>
<li><a href="./performance.html">Performance</a></li>
<li><a href="./aws_sdk_upgrade.html">The upgrade to AWS Java SDK V2</a></li>
<li><a href="./third_party_stores.html">Working with Third-party S3 Stores</a></li>
<li><a href="./troubleshooting_s3a.html">Troubleshooting</a></li>
<li><a href="./prefetching.html">Prefetching</a></li>
<li><a href="directory_markers.html">Controlling the S3A Directory Marker Behavior</a>.</li>
<li><a href="./auditing.html">Auditing</a>.</li>
<li><a href="./committers.html">Committing work to S3 with the &#x201c;S3A Committers&#x201d;</a></li>
<li><a href="./committer_architecture.html">S3A Committers Architecture</a></li>
<li><a href="./assumed_roles.html">Working with IAM Assumed Roles</a></li>
<li><a href="./delegation_tokens.html">S3A Delegation Token Support</a></li>
<li><a href="delegation_token_architecture.html">S3A Delegation Token Architecture</a>.</li>
<li><a href="./auditing_architecture.html">Auditing Architecture</a>.</li>
<li><a href="./testing.html">Testing</a></li>
<li><a href="./s3guard.html">S3Guard</a></li>
</ul></section><section>
<h2><a name="Overview"></a><a name="overview"></a> Overview</h2>
<p>Apache Hadoop&#x2019;s <code>hadoop-aws</code> module provides support for AWS integration. applications to easily use this support.</p>
<p>To include the S3A client in Apache Hadoop&#x2019;s default classpath:</p>
<ol style="list-style-type: decimal">

<li>

<p>Make sure that<code>HADOOP_OPTIONAL_TOOLS</code> in <code>hadoop-env.sh</code> includes <code>hadoop-aws</code> in its list of optional modules to add in the classpath.</p>
</li>
<li>

<p>For client side interaction, you can declare that relevant JARs must be loaded in your <code>~/.hadooprc</code> file:</p>

<div class="source">
<div class="source">
<pre>hadoop_add_to_classpath_tools hadoop-aws
</pre></div></div>
</li>
</ol>
<p>The settings in this file does not propagate to deployed applications, but it will work for local clients such as the <code>hadoop fs</code> command.</p></section><section>
<h2><a name="Introducing_the_Hadoop_S3A_client."></a><a name="introduction"></a> Introducing the Hadoop S3A client.</h2>
<p>Hadoop&#x2019;s &#x201c;S3A&#x201d; client offers high-performance IO against Amazon S3 object store and compatible implementations.</p>
<ul>

<li>Directly reads and writes S3 objects.</li>
<li>Compatible with standard S3 clients.</li>
<li>Compatible with files created by the older <code>s3n://</code> client and Amazon EMR&#x2019;s <code>s3://</code> client.</li>
<li>Supports partitioned uploads for many-GB objects.</li>
<li>Offers a high-performance random IO mode for working with columnar data such as Apache ORC and Apache Parquet files.</li>
<li>Uses Amazon&#x2019;s Java V2 SDK with support for latest S3 features and authentication schemes.</li>
<li>Supports authentication via: environment variables, Hadoop configuration properties, the Hadoop key management store and IAM roles.</li>
<li>Supports per-bucket configuration.</li>
<li>Supports S3 &#x201c;Server Side Encryption&#x201d; for both reading and writing: SSE-S3, SSE-KMS and SSE-C.</li>
<li>Supports S3-CSE client side encryption.</li>
<li>Instrumented with Hadoop metrics.</li>
<li>Actively maintained by the open source community.</li>
</ul><section>
<h3><a name="Other_S3_Connectors"></a>Other S3 Connectors</h3>
<p>There other Hadoop connectors to S3. Only S3A is actively maintained by the Hadoop project itself.</p>
<ol style="list-style-type: decimal">

<li>Amazon EMR&#x2019;s <code>s3://</code> client. This is from the Amazon EMR team, who actively maintain it.</li>
</ol></section></section><section>
<h2><a name="Getting_Started"></a><a name="getting_started"></a> Getting Started</h2>
<p>S3A depends upon two JARs, alongside <code>hadoop-common</code> and its dependencies.</p>
<ul>

<li><code>hadoop-aws</code> JAR. This contains the S3A connector.</li>
<li><code>bundle</code> JAR. This contains the full shaded AWS V2 SDK.</li>
</ul>
<p>The versions of <code>hadoop-common</code> and <code>hadoop-aws</code> must be identical.</p>
<p>To import the libraries into a Maven build, add <code>hadoop-aws</code> JAR to the build dependencies; it will pull in a compatible aws-sdk JAR.</p>
<p>The <code>hadoop-aws</code> JAR <i>does not</i> declare any dependencies other than that dependencies unique to it, the AWS SDK JAR. This is simplify excluding/tuning Hadoop dependency JARs in downstream applications. The <code>hadoop-client</code> or <code>hadoop-common</code> dependency must be declared</p>

<div class="source">
<div class="source">
<pre>&lt;properties&gt;
 &lt;!-- Your exact Hadoop version here--&gt;
  &lt;hadoop.version&gt;3.0.0&lt;/hadoop.version&gt;
&lt;/properties&gt;

&lt;dependencies&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.apache.hadoop&lt;/groupId&gt;
    &lt;artifactId&gt;hadoop-client&lt;/artifactId&gt;
    &lt;version&gt;${hadoop.version}&lt;/version&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.apache.hadoop&lt;/groupId&gt;
    &lt;artifactId&gt;hadoop-aws&lt;/artifactId&gt;
    &lt;version&gt;${hadoop.version}&lt;/version&gt;
  &lt;/dependency&gt;
&lt;/dependencies&gt;
</pre></div></div>
</section><section>
<h2><a name="Warnings"></a><a name="warning"></a> Warnings</h2>
<p>Amazon S3 is an example of &#x201c;an object store&#x201d;. In order to achieve scalability and especially high availability, S3 has &#x2014;as many other cloud object stores have done&#x2014; relaxed some of the constraints which classic &#x201c;POSIX&#x201d; filesystems promise.</p>
<p>For further discussion on these topics, please consult <a href="../../../hadoop-project-dist/hadoop-common/filesystem/index.html">The Hadoop FileSystem API Definition</a>.</p><section>
<h3><a name="Warning_.231:_Directories_are_mimicked"></a>Warning #1: Directories are mimicked</h3>
<p>The S3A clients mimics directories by:</p>
<ol style="list-style-type: decimal">

<li>Creating a stub entry after a <code>mkdirs</code> call, deleting it when a file is added anywhere underneath</li>
<li>When listing a directory, searching for all objects whose path starts with the directory path, and returning them as the listing.</li>
<li>When renaming a directory, taking such a listing and asking S3 to copying the individual objects to new objects with the destination filenames.</li>
<li>When deleting a directory, taking such a listing and deleting the entries in batches.</li>
<li>When renaming or deleting directories, taking such a listing and working on the individual files.</li>
</ol>
<p>Here are some of the consequences:</p>
<ul>

<li>Directories may lack modification times. Parts of Hadoop relying on this can have unexpected behaviour. E.g. the <code>AggregatedLogDeletionService</code> of YARN will not remove the appropriate logfiles.</li>
<li>Directory listing can be slow. Use <code>listFiles(path, recursive)</code> for high performance recursive listings whenever possible.</li>
<li>It is possible to create files under files if the caller tries hard.</li>
<li>The time to rename a directory is proportional to the number of files underneath it (directory or indirectly) and the size of the files. (The copy is executed inside the S3 storage, so the time is independent of the bandwidth from client to S3).</li>
<li>Directory renames are not atomic: they can fail partway through, and callers cannot safely rely on atomic renames as part of a commit algorithm.</li>
<li>Directory deletion is not atomic and can fail partway through.</li>
</ul>
<p>The final three issues surface when using S3 as the immediate destination of work, as opposed to HDFS or other &#x201c;real&#x201d; filesystem.</p>
<p>The <a href="./committers.html">S3A committers</a> are the sole mechanism available to safely save the output of queries directly into S3 object stores through the S3A filesystem when the filesystem structure is how the table is represented.</p></section><section>
<h3><a name="Warning_.232:_Object_stores_have_different_authorization_models"></a>Warning #2: Object stores have different authorization models</h3>
<p>The object authorization model of S3 is much different from the file authorization model of HDFS and traditional file systems. The S3A client simply reports stub information from APIs that would query this metadata:</p>
<ul>

<li>File owner is reported as the current user.</li>
<li>File group also is reported as the current user.</li>
<li>Directory permissions are reported as 777.</li>
<li>File permissions are reported as 666.</li>
</ul>
<p>S3A does not really enforce any authorization checks on these stub permissions. Users authenticate to an S3 bucket using AWS credentials.  It&#x2019;s possible that object ACLs have been defined to enforce authorization at the S3 side, but this happens entirely within the S3 service, not within the S3A implementation.</p></section><section>
<h3><a name="Warning_.234:_Your_AWS_credentials_are_very.2C_very_valuable"></a>Warning #4: Your AWS credentials are very, very valuable</h3>
<p>Your AWS credentials not only pay for services, they offer read and write access to the data. Anyone with the credentials can not only read your datasets &#x2014;they can delete them.</p>
<p>Do not inadvertently share these credentials through means such as:</p>
<ol style="list-style-type: decimal">

<li>Checking in to SCM any configuration files containing the secrets.</li>
<li>Logging them to a console, as they invariably end up being seen.</li>
<li>Including the secrets in bug reports.</li>
<li>Logging the <code>AWS_</code> environment variables.</li>
</ol>
<p>If you do any of these: change your credentials immediately!</p></section></section><section>
<h2><a name="Connecting_to_Amazon_S3_or_a_third-party_store"></a>Connecting to Amazon S3 or a third-party store</h2>
<p>See <a href="connecting.html">Connecting to an Amazon S3 Bucket through the S3A Connector</a>.</p>
<p>Also, please check <a href="connecting.html#s3_endpoint_region_details">S3 endpoint and region settings in detail</a>.</p></section><section>
<h2><a name="Authenticating_with_S3"></a><a name="authenticating"></a> Authenticating with S3</h2>
<p>See <a href="authentication.html">Authenticating with S3</a>.</p></section><section>
<h2><a name="Storing_secrets_with_Hadoop_Credential_Providers"></a><a name="hadoop_credential_providers"></a>Storing secrets with Hadoop Credential Providers</h2>
<p>The Hadoop Credential Provider Framework allows secure &#x201c;Credential Providers&#x201d; to keep secrets outside Hadoop configuration files, storing them in encrypted files in local or Hadoop filesystems, and including them in requests.</p>
<p>The S3A configuration options with sensitive data (<code>fs.s3a.secret.key</code>, <code>fs.s3a.access.key</code>,  <code>fs.s3a.session.token</code> and <code>fs.s3a.encryption.key</code>) can have their data saved to a binary file stored, with the values being read in when the S3A filesystem URL is used for data access. The reference to this credential provider then declared in the Hadoop configuration.</p>
<p>For additional reading on the Hadoop Credential Provider API see: <a href="../../../hadoop-project-dist/hadoop-common/CredentialProviderAPI.html">Credential Provider API</a>.</p>
<p>The following configuration options can be stored in Hadoop Credential Provider stores.</p>

<div class="source">
<div class="source">
<pre>fs.s3a.access.key
fs.s3a.secret.key
fs.s3a.session.token
fs.s3a.encryption.key
fs.s3a.encryption.algorithm
</pre></div></div>

<p>The first three are for authentication; the final two for <a href="./encryption.html">encryption</a>. Of the latter, only the encryption key can be considered &#x201c;sensitive&#x201d;. However, being able to include the algorithm in the credentials allows for a JCECKS file to contain all the options needed to encrypt new data written to S3.</p><section>
<h3><a name="Step_1:_Create_a_credential_file"></a>Step 1: Create a credential file</h3>
<p>A credential file can be created on any Hadoop filesystem; when creating one on HDFS or a Unix filesystem the permissions are automatically set to keep the file private to the reader &#x2014;though as directory permissions are not touched, users should verify that the directory containing the file is readable only by the current user.</p>

<div class="source">
<div class="source">
<pre>hadoop credential create fs.s3a.access.key -value 123 \
    -provider jceks://hdfs@nn1.example.com:9001/user/backup/s3.jceks

hadoop credential create fs.s3a.secret.key -value 456 \
    -provider jceks://hdfs@nn1.example.com:9001/user/backup/s3.jceks
</pre></div></div>

<p>A credential file can be listed, to see what entries are kept inside it</p>

<div class="source">
<div class="source">
<pre>hadoop credential list -provider jceks://hdfs@nn1.example.com:9001/user/backup/s3.jceks

Listing aliases for CredentialProvider: jceks://hdfs@nn1.example.com:9001/user/backup/s3.jceks
fs.s3a.secret.key
fs.s3a.access.key
</pre></div></div>

<p>At this point, the credentials are ready for use.</p></section><section>
<h3><a name="Step_2:_Configure_the_hadoop.security.credential.provider.path_property"></a>Step 2: Configure the <code>hadoop.security.credential.provider.path</code> property</h3>
<p>The URL to the provider must be set in the configuration property <code>hadoop.security.credential.provider.path</code>, either on the command line or in XML configuration files.</p>

<div class="source">
<div class="source">
<pre>&lt;property&gt;
  &lt;name&gt;hadoop.security.credential.provider.path&lt;/name&gt;
  &lt;value&gt;jceks://hdfs@nn1.example.com:9001/user/backup/s3.jceks&lt;/value&gt;
  &lt;description&gt;Path to interrogate for protected credentials.&lt;/description&gt;
&lt;/property&gt;
</pre></div></div>

<p>Because this property only supplies the path to the secrets file, the configuration option itself is no longer a sensitive item.</p>
<p>The property <code>hadoop.security.credential.provider.path</code> is global to all filesystems and secrets. There is another property, <code>fs.s3a.security.credential.provider.path</code> which only lists credential providers for S3A filesystems. The two properties are combined into one, with the list of providers in the <code>fs.s3a.</code> property taking precedence over that of the <code>hadoop.security</code> list (i.e. they are prepended to the common list).</p>

<div class="source">
<div class="source">
<pre>&lt;property&gt;
  &lt;name&gt;fs.s3a.security.credential.provider.path&lt;/name&gt;
  &lt;value /&gt;
  &lt;description&gt;
    Optional comma separated list of credential providers, a list
    which is prepended to that set in hadoop.security.credential.provider.path
  &lt;/description&gt;
&lt;/property&gt;
</pre></div></div>

<p>This was added to support binding different credential providers on a per bucket basis, without adding alternative secrets in the credential list. However, some applications (e.g Hive) prevent the list of credential providers from being dynamically updated by users. As per-bucket secrets are now supported, it is better to include per-bucket keys in JCEKS files and other sources of credentials.</p></section><section>
<h3><a name="Using_secrets_from_credential_providers"></a>Using secrets from credential providers</h3>
<p>Once the provider is set in the Hadoop configuration, Hadoop commands work exactly as if the secrets were in an XML file.</p>

<div class="source">
<div class="source">
<pre>hadoop distcp \
    hdfs://nn1.example.com:9001/user/backup/007020615 s3a://glacier1/

hadoop fs -ls s3a://glacier1/
</pre></div></div>

<p>The path to the provider can also be set on the command line:</p>

<div class="source">
<div class="source">
<pre>hadoop distcp \
    -D hadoop.security.credential.provider.path=jceks://hdfs@nn1.example.com:9001/user/backup/s3.jceks \
    hdfs://nn1.example.com:9001/user/backup/007020615 s3a://glacier1/

hadoop fs \
  -D fs.s3a.security.credential.provider.path=jceks://hdfs@nn1.example.com:9001/user/backup/s3.jceks \
  -ls s3a://glacier1/
</pre></div></div>

<p>Because the provider path is not itself a sensitive secret, there is no risk from placing its declaration on the command line.</p></section></section><section>
<h2><a name="General_S3A_Client_configuration"></a><a name="general_configuration"></a>General S3A Client configuration</h2>
<p>All S3A client options are configured with options with the prefix <code>fs.s3a.</code>.</p>
<p>The client supports <a href="per_bucket_configuration">Per-bucket configuration</a> to allow different buckets to override the shared settings. This is commonly used to change the endpoint, encryption and authentication mechanisms of buckets. and various minor options.</p>
<p>Here are some the S3A properties for use in production.</p>
<ul>

<li>See <a href="./performance.html">Performance</a> for performance related settings including thread and network pool options.</li>
<li>Testing-related options are covered in <a href="./testing.md">Testing</a>.</li>
</ul>

<div class="source">
<div class="source">
<pre>&lt;property&gt;
  &lt;name&gt;fs.s3a.aws.credentials.provider&lt;/name&gt;
  &lt;value&gt;
    org.apache.hadoop.fs.s3a.TemporaryAWSCredentialsProvider,
    org.apache.hadoop.fs.s3a.SimpleAWSCredentialsProvider,
    software.amazon.awssdk.auth.credentials.EnvironmentVariableCredentialsProvider,
    org.apache.hadoop.fs.s3a.auth.IAMInstanceCredentialsProvider
  &lt;/value&gt;
  &lt;description&gt;
    Comma-separated class names of credential provider classes which implement
    software.amazon.awssdk.auth.credentials.AwsCredentialsProvider.

    When S3A delegation tokens are not enabled, this list will be used
    to directly authenticate with S3 and other AWS services.
    When S3A Delegation tokens are enabled, depending upon the delegation
    token binding it may be used
    to communicate wih the STS endpoint to request session/role
    credentials.
  &lt;/description&gt;
&lt;/property&gt;

&lt;property&gt;
  &lt;name&gt;fs.s3a.security.credential.provider.path&lt;/name&gt;
  &lt;value /&gt;
  &lt;description&gt;
    Optional comma separated list of credential providers, a list
    which is prepended to that set in hadoop.security.credential.provider.path
  &lt;/description&gt;
&lt;/property&gt;

&lt;property&gt;
  &lt;name&gt;fs.s3a.assumed.role.arn&lt;/name&gt;
  &lt;value /&gt;
  &lt;description&gt;
    AWS ARN for the role to be assumed.
    Required if the fs.s3a.aws.credentials.provider contains
    org.apache.hadoop.fs.s3a.AssumedRoleCredentialProvider
  &lt;/description&gt;
&lt;/property&gt;

&lt;property&gt;
  &lt;name&gt;fs.s3a.assumed.role.session.name&lt;/name&gt;
  &lt;value /&gt;
  &lt;description&gt;
    Session name for the assumed role, must be valid characters according to
    the AWS APIs.
    Only used if AssumedRoleCredentialProvider is the AWS credential provider.
    If not set, one is generated from the current Hadoop/Kerberos username.
  &lt;/description&gt;
&lt;/property&gt;

&lt;property&gt;
  &lt;name&gt;fs.s3a.assumed.role.policy&lt;/name&gt;
  &lt;value/&gt;
  &lt;description&gt;
    JSON policy to apply to the role.
    Only used if AssumedRoleCredentialProvider is the AWS credential provider.
  &lt;/description&gt;
&lt;/property&gt;

&lt;property&gt;
  &lt;name&gt;fs.s3a.assumed.role.session.duration&lt;/name&gt;
  &lt;value&gt;30m&lt;/value&gt;
  &lt;description&gt;
    Duration of assumed roles before a refresh is attempted.
    Used when session tokens are requested.
    Range: 15m to 1h
  &lt;/description&gt;
&lt;/property&gt;

&lt;property&gt;
  &lt;name&gt;fs.s3a.assumed.role.sts.endpoint&lt;/name&gt;
  &lt;value/&gt;
  &lt;description&gt;
    AWS Security Token Service Endpoint.
    If unset, uses the default endpoint.
    Only used if AssumedRoleCredentialProvider is the AWS credential provider.
    Used by the AssumedRoleCredentialProvider and in Session and Role delegation
    tokens.
  &lt;/description&gt;
&lt;/property&gt;

&lt;property&gt;
  &lt;name&gt;fs.s3a.assumed.role.sts.endpoint.region&lt;/name&gt;
  &lt;value&gt;&lt;/value&gt;
  &lt;description&gt;
    AWS Security Token Service Endpoint's region;
    Needed if fs.s3a.assumed.role.sts.endpoint points to an endpoint
    other than the default one and the v4 signature is used.
    Used by the AssumedRoleCredentialProvider and in Session and Role delegation
    tokens.
  &lt;/description&gt;
&lt;/property&gt;

&lt;property&gt;
  &lt;name&gt;fs.s3a.assumed.role.credentials.provider&lt;/name&gt;
  &lt;value&gt;org.apache.hadoop.fs.s3a.SimpleAWSCredentialsProvider&lt;/value&gt;
  &lt;description&gt;
    List of credential providers to authenticate with the STS endpoint and
    retrieve short-lived role credentials.
    Only used if AssumedRoleCredentialProvider is the AWS credential provider.
    If unset, uses &quot;org.apache.hadoop.fs.s3a.SimpleAWSCredentialsProvider&quot;.
  &lt;/description&gt;
&lt;/property&gt;

&lt;property&gt;
  &lt;name&gt;fs.s3a.delegation.token.binding&lt;/name&gt;
  &lt;value&gt;&lt;/value&gt;
  &lt;description&gt;
    The name of a class to provide delegation tokens support in S3A.
    If unset: delegation token support is disabled.

    Note: for job submission to actually collect these tokens,
    Kerberos must be enabled.

    Bindings available in hadoop-aws are:
    org.apache.hadoop.fs.s3a.auth.delegation.SessionTokenBinding
    org.apache.hadoop.fs.s3a.auth.delegation.FullCredentialsTokenBinding
    org.apache.hadoop.fs.s3a.auth.delegation.RoleTokenBinding
  &lt;/description&gt;
&lt;/property&gt;

&lt;property&gt;
  &lt;name&gt;fs.s3a.connection.maximum&lt;/name&gt;
  &lt;value&gt;96&lt;/value&gt;
  &lt;description&gt;Controls the maximum number of simultaneous connections to S3.
    This must be bigger than the value of fs.s3a.threads.max so as to stop
    threads being blocked waiting for new HTTPS connections.
    Why not equal? The AWS SDK transfer manager also uses these connections.
  &lt;/description&gt;
&lt;/property&gt;

&lt;property&gt;
  &lt;name&gt;fs.s3a.attempts.maximum&lt;/name&gt;
  &lt;value&gt;5&lt;/value&gt;
  &lt;description&gt;
    Number of times the AWS client library should retry errors before
    escalating to the S3A code: {@value}.
    The S3A connector does its own selective retries; the only time the AWS
    SDK operations are not wrapped is during multipart copy via the AWS SDK
    transfer manager.
  &lt;/description&gt;
&lt;/property&gt;

&lt;property&gt;
  &lt;name&gt;fs.s3a.socket.send.buffer&lt;/name&gt;
  &lt;value&gt;8192&lt;/value&gt;
  &lt;description&gt;Socket send buffer hint to amazon connector. Represented in bytes.&lt;/description&gt;
&lt;/property&gt;

&lt;property&gt;
  &lt;name&gt;fs.s3a.socket.recv.buffer&lt;/name&gt;
  &lt;value&gt;8192&lt;/value&gt;
  &lt;description&gt;Socket receive buffer hint to amazon connector. Represented in bytes.&lt;/description&gt;
&lt;/property&gt;

&lt;property&gt;
  &lt;name&gt;fs.s3a.paging.maximum&lt;/name&gt;
  &lt;value&gt;5000&lt;/value&gt;
  &lt;description&gt;How many keys to request from S3 when doing
     directory listings at a time.&lt;/description&gt;
&lt;/property&gt;

&lt;property&gt;
  &lt;name&gt;fs.s3a.multipart.size&lt;/name&gt;
  &lt;value&gt;64M&lt;/value&gt;
  &lt;description&gt;How big (in bytes) to split upload or copy operations up into.
    A suffix from the set {K,M,G,T,P} may be used to scale the numeric value.
  &lt;/description&gt;
&lt;/property&gt;

&lt;property&gt;
  &lt;name&gt;fs.s3a.multipart.threshold&lt;/name&gt;
  &lt;value&gt;128M&lt;/value&gt;
  &lt;description&gt;How big (in bytes) to split upload or copy operations up into.
    This also controls the partition size in renamed files, as rename() involves
    copying the source file(s).
    A suffix from the set {K,M,G,T,P} may be used to scale the numeric value.
  &lt;/description&gt;
&lt;/property&gt;

&lt;property&gt;
  &lt;name&gt;fs.s3a.multiobjectdelete.enable&lt;/name&gt;
  &lt;value&gt;true&lt;/value&gt;
  &lt;description&gt;When enabled, multiple single-object delete requests are replaced by
    a single 'delete multiple objects'-request, reducing the number of requests.
    Beware: legacy S3-compatible object stores might not support this request.
  &lt;/description&gt;
&lt;/property&gt;

&lt;property&gt;
  &lt;name&gt;fs.s3a.acl.default&lt;/name&gt;
  &lt;description&gt;Set a canned ACL for newly created and copied objects. Value may be Private,
      PublicRead, PublicReadWrite, AuthenticatedRead, LogDeliveryWrite, BucketOwnerRead,
      or BucketOwnerFullControl.
    If set, caller IAM role must have &quot;s3:PutObjectAcl&quot; permission on the bucket.
  &lt;/description&gt;
&lt;/property&gt;

&lt;property&gt;
  &lt;name&gt;fs.s3a.multipart.purge&lt;/name&gt;
  &lt;value&gt;false&lt;/value&gt;
  &lt;description&gt;True if you want to purge existing multipart uploads that may not have been
    completed/aborted correctly. The corresponding purge age is defined in
    fs.s3a.multipart.purge.age.
    If set, when the filesystem is instantiated then all outstanding uploads
    older than the purge age will be terminated -across the entire bucket.
    This will impact multipart uploads by other applications and users. so should
    be used sparingly, with an age value chosen to stop failed uploads, without
    breaking ongoing operations.
  &lt;/description&gt;
&lt;/property&gt;

&lt;property&gt;
  &lt;name&gt;fs.s3a.multipart.purge.age&lt;/name&gt;
  &lt;value&gt;86400&lt;/value&gt;
  &lt;description&gt;Minimum age in seconds of multipart uploads to purge
    on startup if &quot;fs.s3a.multipart.purge&quot; is true
  &lt;/description&gt;
&lt;/property&gt;

&lt;property&gt;
  &lt;name&gt;fs.s3a.encryption.algorithm&lt;/name&gt;
  &lt;description&gt;Specify a server-side encryption or client-side
    encryption algorithm for s3a: file system. Unset by default. It supports the
    following values: 'AES256' (for SSE-S3), 'SSE-KMS', 'SSE-C', and 'CSE-KMS'
  &lt;/description&gt;
&lt;/property&gt;

&lt;property&gt;
  &lt;name&gt;fs.s3a.encryption.key&lt;/name&gt;
  &lt;description&gt;Specific encryption key to use if fs.s3a.encryption.algorithm
    has been set to 'SSE-KMS', 'SSE-C' or 'CSE-KMS'. In the case of SSE-C
    , the value of this property should be the Base64 encoded key. If you are
    using SSE-KMS and leave this property empty, you'll be using your default's
    S3 KMS key, otherwise you should set this property to the specific KMS key
    id. In case of 'CSE-KMS' this value needs to be the AWS-KMS Key ID
    generated from AWS console.
  &lt;/description&gt;
&lt;/property&gt;

&lt;property&gt;
    &lt;name&gt;fs.s3a.encryption.context&lt;/name&gt;
    &lt;description&gt;Specific encryption context to use if fs.s3a.encryption.algorithm
      has been set to 'SSE-KMS' or 'DSSE-KMS'. The value of this property is a set
      of non-secret comma-separated key-value pairs of additional contextual
      information about the data that are separated by equal operator (=).
    &lt;/description&gt;
&lt;/property&gt;

&lt;property&gt;
  &lt;name&gt;fs.s3a.signing-algorithm&lt;/name&gt;
  &lt;description&gt;Override the default signing algorithm so legacy
    implementations can still be used&lt;/description&gt;
&lt;/property&gt;

&lt;property&gt;
  &lt;name&gt;fs.s3a.block.size&lt;/name&gt;
  &lt;value&gt;32M&lt;/value&gt;
  &lt;description&gt;Block size to use when reading files using s3a: file system.
    A suffix from the set {K,M,G,T,P} may be used to scale the numeric value.
  &lt;/description&gt;
&lt;/property&gt;

&lt;property&gt;
  &lt;name&gt;fs.s3a.buffer.dir&lt;/name&gt;
  &lt;value&gt;${env.LOCAL_DIRS:-${hadoop.tmp.dir}}/s3a&lt;/value&gt;
  &lt;description&gt;Comma separated list of directories that will be used to buffer file
    uploads to.
    Yarn container path will be used as default value on yarn applications,
    otherwise fall back to hadoop.tmp.dir
  &lt;/description&gt;
&lt;/property&gt;

&lt;property&gt;
  &lt;name&gt;fs.s3a.fast.upload.buffer&lt;/name&gt;
  &lt;value&gt;disk&lt;/value&gt;
  &lt;description&gt;
    The buffering mechanism to for data being written.
    Values: disk, array, bytebuffer.

    &quot;disk&quot; will use the directories listed in fs.s3a.buffer.dir as
    the location(s) to save data prior to being uploaded.

    &quot;array&quot; uses arrays in the JVM heap

    &quot;bytebuffer&quot; uses off-heap memory within the JVM.

    Both &quot;array&quot; and &quot;bytebuffer&quot; will consume memory in a single stream up to the number
    of blocks set by:

        fs.s3a.multipart.size * fs.s3a.fast.upload.active.blocks.

    If using either of these mechanisms, keep this value low

    The total number of threads performing work across all threads is set by
    fs.s3a.threads.max, with fs.s3a.max.total.tasks values setting the number of queued
    work items.
  &lt;/description&gt;
&lt;/property&gt;

&lt;property&gt;
  &lt;name&gt;fs.s3a.fast.upload.active.blocks&lt;/name&gt;
  &lt;value&gt;4&lt;/value&gt;
  &lt;description&gt;
    Maximum Number of blocks a single output stream can have
    active (uploading, or queued to the central FileSystem
    instance's pool of queued operations.

    This stops a single stream overloading the shared thread pool.
  &lt;/description&gt;
&lt;/property&gt;

&lt;property&gt;
  &lt;name&gt;fs.s3a.readahead.range&lt;/name&gt;
  &lt;value&gt;64K&lt;/value&gt;
  &lt;description&gt;Bytes to read ahead during a seek() before closing and
  re-opening the S3 HTTP connection. This option will be overridden if
  any call to setReadahead() is made to an open stream.
  A suffix from the set {K,M,G,T,P} may be used to scale the numeric value.
  &lt;/description&gt;
&lt;/property&gt;

&lt;property&gt;
  &lt;name&gt;fs.s3a.user.agent.prefix&lt;/name&gt;
  &lt;value&gt;&lt;/value&gt;
  &lt;description&gt;
    Sets a custom value that will be prepended to the User-Agent header sent in
    HTTP requests to the S3 back-end by S3AFileSystem.  The User-Agent header
    always includes the Hadoop version number followed by a string generated by
    the AWS SDK.  An example is &quot;User-Agent: Hadoop 2.8.0, aws-sdk-java/1.10.6&quot;.
    If this optional property is set, then its value is prepended to create a
    customized User-Agent.  For example, if this configuration property was set
    to &quot;MyApp&quot;, then an example of the resulting User-Agent would be
    &quot;User-Agent: MyApp, Hadoop 2.8.0, aws-sdk-java/1.10.6&quot;.
  &lt;/description&gt;
&lt;/property&gt;

&lt;property&gt;
  &lt;name&gt;fs.s3a.impl&lt;/name&gt;
  &lt;value&gt;org.apache.hadoop.fs.s3a.S3AFileSystem&lt;/value&gt;
  &lt;description&gt;The implementation class of the S3A Filesystem&lt;/description&gt;
&lt;/property&gt;

&lt;property&gt;
  &lt;name&gt;fs.s3a.retry.limit&lt;/name&gt;
  &lt;value&gt;7&lt;/value&gt;
  &lt;description&gt;
    Number of times to retry any repeatable S3 client request on failure,
    excluding throttling requests.
  &lt;/description&gt;
&lt;/property&gt;

&lt;property&gt;
  &lt;name&gt;fs.s3a.retry.interval&lt;/name&gt;
  &lt;value&gt;500ms&lt;/value&gt;
  &lt;description&gt;
    Initial retry interval when retrying operations for any reason other
    than S3 throttle errors.
  &lt;/description&gt;
&lt;/property&gt;

&lt;property&gt;
  &lt;name&gt;fs.s3a.retry.throttle.limit&lt;/name&gt;
  &lt;value&gt;20&lt;/value&gt;
  &lt;description&gt;
    Number of times to retry any throttled request.
  &lt;/description&gt;
&lt;/property&gt;

&lt;property&gt;
  &lt;name&gt;fs.s3a.retry.throttle.interval&lt;/name&gt;
  &lt;value&gt;100ms&lt;/value&gt;
  &lt;description&gt;
    Initial between retry attempts on throttled requests, +/- 50%. chosen at random.
    i.e. for an intial value of 3000ms, the initial delay would be in the range 1500ms to 4500ms.
    Backoffs are exponential; again randomness is used to avoid the thundering heard problem.
    500ms is the default value used by the AWS S3 Retry policy.
  &lt;/description&gt;
&lt;/property&gt;

&lt;property&gt;
  &lt;name&gt;fs.s3a.committer.name&lt;/name&gt;
  &lt;value&gt;file&lt;/value&gt;
  &lt;description&gt;
    Committer to create for output to S3A, one of:
    &quot;file&quot;, &quot;directory&quot;, &quot;partitioned&quot;, &quot;magic&quot;.
  &lt;/description&gt;
&lt;/property&gt;

&lt;property&gt;
  &lt;name&gt;fs.s3a.committer.magic.enabled&lt;/name&gt;
  &lt;value&gt;true&lt;/value&gt;
  &lt;description&gt;
    Enable support in the S3A filesystem for the &quot;Magic&quot; committer.
  &lt;/description&gt;
&lt;/property&gt;

&lt;property&gt;
  &lt;name&gt;fs.s3a.committer.threads&lt;/name&gt;
  &lt;value&gt;8&lt;/value&gt;
  &lt;description&gt;
    Number of threads in committers for parallel operations on files
    (upload, commit, abort, delete...)
  &lt;/description&gt;
&lt;/property&gt;

&lt;property&gt;
  &lt;name&gt;fs.s3a.committer.staging.tmp.path&lt;/name&gt;
  &lt;value&gt;tmp/staging&lt;/value&gt;
  &lt;description&gt;
    Path in the cluster filesystem for temporary data.
    This is for HDFS, not the local filesystem.
    It is only for the summary data of each file, not the actual
    data being committed.
    Using an unqualified path guarantees that the full path will be
    generated relative to the home directory of the user creating the job,
    hence private (assuming home directory permissions are secure).
  &lt;/description&gt;
&lt;/property&gt;

&lt;property&gt;
  &lt;name&gt;fs.s3a.committer.staging.unique-filenames&lt;/name&gt;
  &lt;value&gt;true&lt;/value&gt;
  &lt;description&gt;
    Option for final files to have a unique name through job attempt info,
    or the value of fs.s3a.committer.staging.uuid
    When writing data with the &quot;append&quot; conflict option, this guarantees
    that new data will not overwrite any existing data.
  &lt;/description&gt;
&lt;/property&gt;

&lt;property&gt;
  &lt;name&gt;fs.s3a.committer.staging.conflict-mode&lt;/name&gt;
  &lt;value&gt;append&lt;/value&gt;
  &lt;description&gt;
    Staging committer conflict resolution policy.
    Supported: &quot;fail&quot;, &quot;append&quot;, &quot;replace&quot;.
  &lt;/description&gt;
&lt;/property&gt;

&lt;property&gt;
  &lt;name&gt;fs.s3a.committer.abort.pending.uploads&lt;/name&gt;
  &lt;value&gt;true&lt;/value&gt;
  &lt;description&gt;
    Should the committers abort all pending uploads to the destination
    directory?

    Set to false if more than one job is writing to the same directory tree.
  &lt;/description&gt;
&lt;/property&gt;

&lt;property&gt;
  &lt;name&gt;fs.s3a.list.version&lt;/name&gt;
  &lt;value&gt;2&lt;/value&gt;
  &lt;description&gt;
    Select which version of the S3 SDK's List Objects API to use.  Currently
    support 2 (default) and 1 (older API).
  &lt;/description&gt;
&lt;/property&gt;

&lt;property&gt;
  &lt;name&gt;fs.s3a.etag.checksum.enabled&lt;/name&gt;
  &lt;value&gt;false&lt;/value&gt;
  &lt;description&gt;
    Should calls to getFileChecksum() return the etag value of the remote
    object.
    WARNING: if enabled, distcp operations between HDFS and S3 will fail unless
    -skipcrccheck is set.
  &lt;/description&gt;
&lt;/property&gt;

&lt;property&gt;
  &lt;name&gt;fs.s3a.change.detection.source&lt;/name&gt;
  &lt;value&gt;etag&lt;/value&gt;
  &lt;description&gt;
    Select which S3 object attribute to use for change detection.
    Currently support 'etag' for S3 object eTags and 'versionid' for
    S3 object version IDs.  Use of version IDs requires object versioning to be
    enabled for each S3 bucket utilized.  Object versioning is disabled on
    buckets by default. When version ID is used, the buckets utilized should
    have versioning enabled before any data is written.
  &lt;/description&gt;
&lt;/property&gt;

&lt;property&gt;
  &lt;name&gt;fs.s3a.change.detection.mode&lt;/name&gt;
  &lt;value&gt;server&lt;/value&gt;
  &lt;description&gt;
    Determines how change detection is applied to alert to inconsistent S3
    objects read during or after an overwrite. Value 'server' indicates to apply
    the attribute constraint directly on GetObject requests to S3. Value 'client'
    means to do a client-side comparison of the attribute value returned in the
    response.  Value 'server' would not work with third-party S3 implementations
    that do not support these constraints on GetObject. Values 'server' and
    'client' generate RemoteObjectChangedException when a mismatch is detected.
    Value 'warn' works like 'client' but generates only a warning.  Value 'none'
    will ignore change detection completely.
  &lt;/description&gt;
&lt;/property&gt;

&lt;property&gt;
  &lt;name&gt;fs.s3a.change.detection.version.required&lt;/name&gt;
  &lt;value&gt;true&lt;/value&gt;
  &lt;description&gt;
    Determines if S3 object version attribute defined by
    fs.s3a.change.detection.source should be treated as required.  If true and the
    referred attribute is unavailable in an S3 GetObject response,
    NoVersionAttributeException is thrown.  Setting to 'true' is encouraged to
    avoid potential for inconsistent reads with third-party S3 implementations or
    against S3 buckets that have object versioning disabled.
  &lt;/description&gt;
&lt;/property&gt;

&lt;property&gt;
  &lt;name&gt;fs.s3a.ssl.channel.mode&lt;/name&gt;
  &lt;value&gt;default_jsse&lt;/value&gt;
  &lt;description&gt;
    If secure connections to S3 are enabled, configures the SSL
    implementation used to encrypt connections to S3. Supported values are:
    &quot;default_jsse&quot;, &quot;default_jsse_with_gcm&quot;, &quot;default&quot;, and &quot;openssl&quot;.
    &quot;default_jsse&quot; uses the Java Secure Socket Extension package (JSSE).
    However, when running on Java 8, the GCM cipher is removed from the list
    of enabled ciphers. This is due to performance issues with GCM in Java 8.
    &quot;default_jsse_with_gcm&quot; uses the JSSE with the default list of cipher
    suites. &quot;default_jsse_with_gcm&quot; is equivalent to the behavior prior to
    this feature being introduced. &quot;default&quot; attempts to use OpenSSL rather
    than the JSSE for SSL encryption, if OpenSSL libraries cannot be loaded,
    it falls back to the &quot;default_jsse&quot; behavior. &quot;openssl&quot; attempts to use
    OpenSSL as well, but fails if OpenSSL libraries cannot be loaded.
  &lt;/description&gt;
&lt;/property&gt;

&lt;property&gt;
  &lt;name&gt;fs.s3a.downgrade.syncable.exceptions&lt;/name&gt;
  &lt;value&gt;true&lt;/value&gt;
  &lt;description&gt;
    Warn but continue when applications use Syncable.hsync when writing
    to S3A.
  &lt;/description&gt;
&lt;/property&gt;

&lt;!--
The switch to turn S3A auditing on or off.
--&gt;
&lt;property&gt;
  &lt;name&gt;fs.s3a.audit.enabled&lt;/name&gt;
  &lt;value&gt;true&lt;/value&gt;
  &lt;description&gt;
    Should auditing of S3A requests be enabled?
  &lt;/description&gt;
&lt;/property&gt;

</pre></div></div>
</section><section>
<h2><a name="Retry_and_Recovery"></a><a name="retry_and_recovery"></a>Retry and Recovery</h2>
<p>The S3A client makes a best-effort attempt at recovering from network failures; this section covers the details of what it does.</p>
<p>The S3A divides exceptions returned by the AWS SDK into different categories, and chooses a different retry policy based on their type and whether or not the failing operation is idempotent.</p><section>
<h3><a name="Unrecoverable_Problems:_Fail_Fast"></a>Unrecoverable Problems: Fail Fast</h3>
<ul>

<li>No object/bucket store: <code>FileNotFoundException</code></li>
<li>No access permissions: <code>AccessDeniedException</code></li>
<li>Network errors considered unrecoverable (<code>UnknownHostException</code>, <code>NoRouteToHostException</code>, <code>AWSRedirectException</code>).</li>
<li>Interruptions: <code>InterruptedIOException</code>, <code>InterruptedException</code>.</li>
<li>Rejected HTTP requests: <code>InvalidRequestException</code></li>
</ul>
<p>These and others are all considered unrecoverable: S3A will make no attempt to recover from them. The AWS SDK itself may retry before the S3A connector sees the exception. As an example, the SDK will retry on <code>UnknownHostException</code> in case it is a transient DNS error.</p></section><section>
<h3><a name="Possibly_Recoverable_Problems:_Retry"></a>Possibly Recoverable Problems: Retry</h3>
<ul>

<li>Connection timeout: <code>ConnectTimeoutException</code>. Timeout before setting up a connection to the S3 endpoint (or proxy).</li>
<li>HTTP response status code 400, &#x201c;Bad Request&#x201d;</li>
</ul>
<p>The status code 400, Bad Request usually means that the request is unrecoverable; it&#x2019;s the generic &#x201c;No&#x201d; response. Very rarely it does recover, which is why it is in this category, rather than that of unrecoverable failures.</p>
<p>These failures will be retried with an exponential sleep interval set in <code>fs.s3a.retry.interval</code>, up to the limit set in <code>fs.s3a.retry.limit</code>.</p></section><section>
<h3><a name="Only_retriable_on_idempotent_operations"></a>Only retriable on idempotent operations</h3>
<p>Some network failures are considered to be retriable if they occur on idempotent operations; there&#x2019;s no way to know if they happened after the request was processed by S3.</p>
<ul>

<li><code>SocketTimeoutException</code>: general network failure.</li>
<li><code>EOFException</code> : the connection was broken while reading data</li>
<li>&#x201c;No response from Server&#x201d; (443, 444) HTTP responses.</li>
<li>Any other AWS client, service or S3 exception.</li>
</ul>
<p>These failures will be retried with an exponential sleep interval set in <code>fs.s3a.retry.interval</code>, up to the limit set in <code>fs.s3a.retry.limit</code>.</p>
<p><i>Important</i>: DELETE is considered idempotent, hence: <code>FileSystem.delete()</code> and <code>FileSystem.rename()</code> will retry their delete requests on any of these failures.</p>
<p>The issue of whether delete should be idempotent has been a source of historical controversy in Hadoop.</p>
<ol style="list-style-type: decimal">

<li>In the absence of any other changes to the object store, a repeated DELETE request will eventually result in the named object being deleted; it&#x2019;s a no-op if reprocessed. As indeed, is <code>Filesystem.delete()</code>.</li>
<li>If another client creates a file under the path, it will be deleted.</li>
<li>Any filesystem supporting an atomic <code>FileSystem.create(path, overwrite=false)</code> operation to reject file creation if the path exists MUST NOT consider delete to be idempotent, because a <code>create(path, false)</code> operation will only succeed if the first <code>delete()</code> call has already succeeded.</li>
<li>And a second, retried <code>delete()</code> call could delete the new data.</li>
</ol>
<p>Because S3 is eventually consistent <i>and</i> doesn&#x2019;t support an atomic create-no-overwrite operation, the choice is more ambiguous.</p>
<p>S3A considers delete to be idempotent because it is convenient for many workflows, including the commit protocols. Just be aware that in the presence of transient failures, more things may be deleted than expected.</p></section><section>
<h3><a name="Throttled_requests_from_S3"></a>Throttled requests from S3</h3>
<p>When AWS S3 returns a response indicating that requests from the caller are being throttled, an exponential back-off with an initial interval and a maximum number of requests.</p>

<div class="source">
<div class="source">
<pre>&lt;property&gt;
  &lt;name&gt;fs.s3a.retry.throttle.limit&lt;/name&gt;
  &lt;value&gt;${fs.s3a.attempts.maximum}&lt;/value&gt;
  &lt;description&gt;
    Number of times to retry any throttled request.
  &lt;/description&gt;
&lt;/property&gt;

&lt;property&gt;
  &lt;name&gt;fs.s3a.retry.throttle.interval&lt;/name&gt;
  &lt;value&gt;1000ms&lt;/value&gt;
  &lt;description&gt;
    Interval between retry attempts on throttled requests.
  &lt;/description&gt;
&lt;/property&gt;
</pre></div></div>

<p>Notes</p>
<ol style="list-style-type: decimal">

<li>There is also throttling taking place inside the AWS SDK; this is managed by the value <code>fs.s3a.attempts.maximum</code>.</li>
<li>Throttling events are tracked in the S3A filesystem metrics and statistics.</li>
<li>Amazon KMS may throttle a customer based on the total rate of uses of KMS <i>across all user accounts and applications</i>.</li>
</ol>
<p>Throttling of S3 requests is all too common; it is caused by too many clients trying to access the same shard of S3 Storage. This generally happen if there are too many reads, those being the most common in Hadoop applications. This problem is exacerbated by Hive&#x2019;s partitioning strategy used when storing data, such as partitioning by year and then month. This results in paths with little or no variation at their start, which ends up in all the data being stored in the same shard(s).</p>
<p>Here are some expensive operations; the more of these taking place against part of an S3 bucket, the more load it experiences. * Many clients trying to list directories or calling <code>getFileStatus</code> on paths (LIST and HEAD requests respectively) * The GET requests issued when reading data. * Random IO used when reading columnar data (ORC, Parquet) means that many more GET requests than a simple one-per-file read. * The number of active writes to that part of the S3 bucket.</p>
<p>A special case is when enough data has been written into part of an S3 bucket that S3 decides to split the data across more than one shard: this is believed to be one by some copy operation which can take some time. While this is under way, S3 clients access data under these paths will be throttled more than usual.</p>
<p>Mitigation strategies</p>
<ol style="list-style-type: decimal">

<li>Use separate buckets for intermediate data/different applications/roles.</li>
<li>Use significantly different paths for different datasets in the same bucket.</li>
<li>Increase the value of <code>fs.s3a.retry.throttle.interval</code> to provide longer delays between attempts.</li>
<li>Reduce the parallelism of the queries. The more tasks trying to access data in parallel, the more load.</li>
<li>Reduce <code>fs.s3a.threads.max</code> to reduce the amount of parallel operations performed by clients. !. Maybe: increase <code>fs.s3a.readahead.range</code> to increase the minimum amount of data asked for in every GET request, as well as how much data is skipped in the existing stream before aborting it and creating a new stream.</li>
<li>KMS: &#x201c;consult AWS about increasing your capacity&#x201d;.</li>
</ol></section></section><section>
<h2><a name="Handling_Read-During-Overwrite"></a>Handling Read-During-Overwrite</h2>
<p>Read-during-overwrite is the condition where a writer overwrites a file while a reader has an open input stream on the file.  Depending on configuration, the S3AFileSystem may detect this and throw a <code>RemoteFileChangedException</code> in conditions where the reader&#x2019;s input stream might otherwise silently switch over from reading bytes from the original version of the file to reading bytes from the new version.</p>
<p>The configurations items controlling this behavior are:</p>

<div class="source">
<div class="source">
<pre>&lt;property&gt;
  &lt;name&gt;fs.s3a.change.detection.source&lt;/name&gt;
  &lt;value&gt;etag&lt;/value&gt;
  &lt;description&gt;
    Select which S3 object attribute to use for change detection.
    Currently support 'etag' for S3 object eTags and 'versionid' for
    S3 object version IDs.  Use of version IDs requires object versioning to be
    enabled for each S3 bucket utilized.  Object versioning is disabled on
    buckets by default. When version ID is used, the buckets utilized should
    have versioning enabled before any data is written.
  &lt;/description&gt;
&lt;/property&gt;

&lt;property&gt;
  &lt;name&gt;fs.s3a.change.detection.mode&lt;/name&gt;
  &lt;value&gt;server&lt;/value&gt;
  &lt;description&gt;
    Determines how change detection is applied to alert to S3 objects
    rewritten while being read. Value 'server' indicates to apply the attribute
    constraint directly on GetObject requests to S3. Value 'client' means to do a
    client-side comparison of the attribute value returned in the response.  Value
    'server' would not work with third-party S3 implementations that do not
    support these constraints on GetObject. Values 'server' and 'client' generate
    RemoteObjectChangedException when a mismatch is detected.  Value 'warn' works
    like 'client' but generates only a warning.  Value 'none' will ignore change
    detection completely.
  &lt;/description&gt;
&lt;/property&gt;

&lt;property&gt;
  &lt;name&gt;fs.s3a.change.detection.version.required&lt;/name&gt;
  &lt;value&gt;true&lt;/value&gt;
  &lt;description&gt;
    Determines if S3 object version attribute defined by
    fs.s3.change.detection.source should be treated as required.  If true and the
    referred attribute is unavailable in an S3 GetObject response,
    NoVersionAttributeException is thrown.  Setting to 'true' is encouraged to
    avoid potential for inconsistent reads with third-party S3 implementations or
    against S3 buckets that have object versioning disabled.
  &lt;/description&gt;
&lt;/property&gt;
</pre></div></div>

<p>In the default configuration, S3 object eTags are used to detect changes.  When the filesystem retrieves a file from S3 using <a class="externalLink" href="https://docs.aws.amazon.com/AmazonS3/latest/API/RESTObjectGET.html">Get Object</a>, it captures the eTag and uses that eTag in an <code>If-Match</code> condition on each subsequent request.  If a concurrent writer has overwritten the file, the &#x2018;If-Match&#x2019; condition will fail and a <code>RemoteFileChangedException</code> will be thrown.</p>
<p>Even in this default configuration, a new write may not trigger this exception on an open reader.  For example, if the reader only reads forward in the file then only a single S3 &#x2018;Get Object&#x2019; request is made and the full contents of the file are streamed from a single response.  An overwrite of the file after the &#x2018;Get Object&#x2019; request would not be seen at all by a reader with an input stream that had already read the first byte.  Seeks backward on the other hand can result in new &#x2018;Get Object&#x2019; requests that can trigger the <code>RemoteFileChangedException</code>.</p><section>
<h3><a name="Change_detection_with_S3_Versions."></a>Change detection with S3 Versions.</h3>
<p>It is possible to switch to using the <a class="externalLink" href="https://docs.aws.amazon.com/AmazonS3/latest/dev/ObjectVersioning.html">S3 object version id</a> instead of eTag as the change detection mechanism.  Use of this option requires object versioning to be enabled on any S3 buckets used by the filesystem.  The benefit of using version id instead of eTag is potentially reduced frequency of <code>RemoteFileChangedException</code>. With object versioning enabled, old versions of objects remain available after they have been overwritten. This means an open input stream will still be able to seek backwards after a concurrent writer has overwritten the file. The reader will retain their consistent view of the version of the file from which they read the first byte. Because the version ID is null for objects written prior to enablement of object versioning, <b>this option should only be used when the S3 buckets have object versioning enabled from the beginning.</b></p>
<p>Note: when you rename files the copied files may have a different version number.</p></section><section>
<h3><a name="Change_Detection_Modes."></a>Change Detection Modes.</h3>
<p>Configurable change detection mode is the next option.  Different modes are available primarily for compatibility with third-party S3 implementations which may not support all change detection mechanisms.</p>
<ul>

<li><code>server</code>: the version/etag check is performed on the server by adding extra headers to the <code>GET</code> request. This is the default.</li>
<li><code>client</code> : check on the client by comparing the eTag/version ID of a reopened file with the previous version. This is useful when the implementation doesn&#x2019;t support the <code>If-Match</code> header.</li>
<li><code>warn</code>: check on the client, but only warn on a mismatch, rather than fail.</li>
<li><code>none</code> do not check. Useful if the implementation doesn&#x2019;t provide eTag or version ID support at all or you would like to retain previous behavior where the reader&#x2019;s input stream silently switches over to the new object version (not recommended).</li>
</ul>
<p>The final option (<code>fs.s3a.change.detection.version.required</code>) is present primarily to ensure the filesystem doesn&#x2019;t silently ignore the condition where it is configured to use version ID on a bucket that doesn&#x2019;t have object versioning enabled or alternatively it is configured to use eTag on an S3 implementation that doesn&#x2019;t return eTags.</p>
<p>When <code>true</code> (default) and &#x2018;Get Object&#x2019; doesn&#x2019;t return eTag or version ID (depending on configured &#x2018;source&#x2019;), a <code>NoVersionAttributeException</code> will be thrown.  When <code>false</code> and eTag or version ID is not returned, the stream can be read, but without any version checking.</p></section></section><section>
<h2><a name="Configuring_different_S3_buckets_with_Per-Bucket_Configuration"></a><a name="per_bucket_configuration"></a>Configuring different S3 buckets with Per-Bucket Configuration</h2>
<p>Different S3 buckets can be accessed with different S3A client configurations. This allows for different endpoints, data read and write strategies, as well as login details.</p>
<ol style="list-style-type: decimal">

<li>All <code>fs.s3a</code> options other than a small set of unmodifiable values (currently <code>fs.s3a.impl</code>) can be set on a per bucket basis.</li>
<li>The bucket specific option is set by replacing the <code>fs.s3a.</code> prefix on an option with <code>fs.s3a.bucket.BUCKETNAME.</code>, where <code>BUCKETNAME</code> is the name of the bucket.</li>
<li>When connecting to a bucket, all options explicitly set will override the base <code>fs.s3a.</code> values.</li>
</ol>
<p>As an example, a configuration could have a base configuration to use the IAM role information available when deployed in Amazon EC2.</p>

<div class="source">
<div class="source">
<pre>&lt;property&gt;
  &lt;name&gt;fs.s3a.aws.credentials.provider&lt;/name&gt;
  &lt;value&gt;org.apache.hadoop.fs.s3a.auth.IAMInstanceCredentialsProvider&lt;/value&gt;
&lt;/property&gt;
</pre></div></div>

<p>This will become the default authentication mechanism for S3A buckets.</p>
<p>A bucket <code>s3a://nightly/</code> used for nightly data can then be given a session key:</p>

<div class="source">
<div class="source">
<pre>&lt;property&gt;
  &lt;name&gt;fs.s3a.bucket.nightly.access.key&lt;/name&gt;
  &lt;value&gt;AKAACCESSKEY-2&lt;/value&gt;
&lt;/property&gt;

&lt;property&gt;
  &lt;name&gt;fs.s3a.bucket.nightly.secret.key&lt;/name&gt;
  &lt;value&gt;SESSIONSECRETKEY&lt;/value&gt;
&lt;/property&gt;

&lt;property&gt;
  &lt;name&gt;fs.s3a.bucket.nightly.session.token&lt;/name&gt;
  &lt;value&gt;Short-lived-session-token&lt;/value&gt;
&lt;/property&gt;

&lt;property&gt;
  &lt;name&gt;fs.s3a.bucket.nightly.aws.credentials.provider&lt;/name&gt;
  &lt;value&gt;org.apache.hadoop.fs.s3a.TemporaryAWSCredentialsProvider&lt;/value&gt;
&lt;/property&gt;
</pre></div></div>

<p>Finally, the public <code>s3a://noaa-isd-pds/</code> bucket can be accessed anonymously:</p>

<div class="source">
<div class="source">
<pre>&lt;property&gt;
  &lt;name&gt;fs.s3a.bucket.noaa-isd-pds.aws.credentials.provider&lt;/name&gt;
  &lt;value&gt;org.apache.hadoop.fs.s3a.AnonymousAWSCredentialsProvider&lt;/value&gt;
&lt;/property&gt;
</pre></div></div>
<section><section>
<h4><a name="per-bucket_configuration_and_deprecated_configuration_options"></a>per-bucket configuration and deprecated configuration options</h4>
<p>Per-bucket declaration of the deprecated encryption options will take priority over a global option -even when the global option uses the newer configuration keys.</p>
<p>This means that when setting encryption options in XML files, the option, <code>fs.bucket.BUCKET.fs.s3a.server-side-encryption-algorithm</code> will take priority over the global value of <code>fs.bucket.s3a.encryption.algorithm</code>. The same holds for the encryption key option <code>fs.s3a.encryption.key</code> and its predecessor <code>fs.s3a.server-side-encryption.key</code>.</p>
<p>For a site configuration of:</p>

<div class="source">
<div class="source">
<pre>&lt;property&gt;
  &lt;name&gt;fs.s3a.bucket.nightly.server-side-encryption-algorithm&lt;/name&gt;
  &lt;value&gt;SSE-KMS&lt;/value&gt;
&lt;/property&gt;

&lt;property&gt;
  &lt;name&gt;fs.s3a.bucket.nightly.server-side-encryption.key&lt;/name&gt;
  &lt;value&gt;arn:aws:kms:eu-west-2:1528130000000:key/753778e4-2d0f-42e6-b894-6a3ae4ea4e5f&lt;/value&gt;
&lt;/property&gt;

&lt;property&gt;
  &lt;name&gt;fs.s3a.encryption.algorithm&lt;/name&gt;
  &lt;value&gt;AES256&lt;/value&gt;
&lt;/property&gt;

&lt;property&gt;
  &lt;name&gt;fs.s3a.encryption.key&lt;/name&gt;
  &lt;value&gt;unset&lt;/value&gt;
&lt;/property&gt;

&lt;property&gt;
  &lt;name&gt;fs.s3a.encryption.context&lt;/name&gt;
  &lt;value&gt;unset&lt;/value&gt;
&lt;/property&gt;


</pre></div></div>

<p>The bucket &#x201c;nightly&#x201d; will be encrypted with SSE-KMS using the KMS key <code>arn:aws:kms:eu-west-2:1528130000000:key/753778e4-2d0f-42e6-b894-6a3ae4ea4e5f</code></p></section></section></section><section>
<h2><a name="Requester_Pays_buckets"></a><a name="requester_pays"></a>Requester Pays buckets</h2>
<p>S3A supports buckets with <a class="externalLink" href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/RequesterPaysBuckets.html">Requester Pays</a> enabled. When a bucket is configured with requester pays, the requester must cover the per-request cost.</p>
<p>For requests to be successful, the S3 client must acknowledge that they will pay for these requests by setting a request flag, usually a header, on each request.</p>
<p>To enable this feature within S3A, configure the <code>fs.s3a.requester.pays.enabled</code> property.</p>

<div class="source">
<div class="source">
<pre>&lt;property&gt;
    &lt;name&gt;fs.s3a.requester.pays.enabled&lt;/name&gt;
    &lt;value&gt;true&lt;/value&gt;
&lt;/property&gt;
</pre></div></div>
</section><section>
<h2><a name="Storage_Classes"></a><a name="storage_classes"></a>Storage Classes</h2>
<p>Amazon S3 offers a range of <a class="externalLink" href="https://aws.amazon.com/s3/storage-classes/">Storage Classes</a> that you can choose from based on behavior of your applications. By using the right storage class, you can reduce the cost of your bucket.</p>
<p>S3A uses Standard storage class for PUT object requests by default, which is suitable for general use cases. To use a specific storage class, set the value in <code>fs.s3a.create.storage.class</code> property to the storage class you want.</p>

<div class="source">
<div class="source">
<pre>&lt;property&gt;
    &lt;name&gt;fs.s3a.create.storage.class&lt;/name&gt;
    &lt;value&gt;intelligent_tiering&lt;/value&gt;
&lt;/property&gt;
</pre></div></div>

<p>Please note that S3A does not support reading from archive storage classes at the moment. <code>AccessDeniedException</code> with <code>InvalidObjectState</code> will be thrown if you&#x2019;re trying to do so.</p>
<p>When a file is &#x201c;renamed&#x201d; through the s3a connector it is copied then deleted. Storage Classes will normally be propagated.</p></section><section>
<h2><a name="Configuring_S3A_for_S3_on_Outposts"></a><a name="outposts"></a>Configuring S3A for S3 on Outposts</h2>
<p>S3A now supports <a class="externalLink" href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/S3onOutposts.html">S3 on Outposts</a>. Accessing data through an access point is done by using its Amazon Resource Name (ARN), as opposed to just the bucket name. The only supported storage class on Outposts is <code>OUTPOSTS</code>, and by default objects are encrypted with <a class="externalLink" href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/s3-outposts-data-encryption.html">SSE-S3</a>. You can set the Access Point ARN property using the following per bucket configuration property:</p>

<div class="source">
<div class="source">
<pre>&lt;property&gt;
  &lt;name&gt;fs.s3a.bucket.sample-outpost-bucket.accesspoint.arn&lt;/name&gt;
  &lt;value&gt;arn:aws:s3-outposts:region:account-id:outpost/outpost-id/accesspoint/accesspoint-name&lt;/value&gt;
  &lt;description&gt;Configure S3a traffic to use this S3 on Outposts Access Point ARN&lt;/description&gt;
&lt;/property&gt;
</pre></div></div>

<p>This configures access to the <code>sample-outpost-bucket</code> for S3A to go through the new Access Point ARN. So, for example <code>s3a://sample-outpost-bucket/key</code> will now use your configured ARN when getting data from S3 on Outpost instead of your bucket.</p></section><section>
<h2><a name="How_S3A_writes_data_to_S3"></a><a name="upload"></a>How S3A writes data to S3</h2>
<p>The original S3A client implemented file writes by buffering all data to disk as it was written to the <code>OutputStream</code>. Only when the stream&#x2019;s <code>close()</code> method was called would the upload start.</p>
<p>This made output slow, especially on large uploads, and could even fill up the disk space of small (virtual) disks.</p>
<p>Hadoop 2.7 added the <code>S3AFastOutputStream</code> alternative, which Hadoop 2.8 expanded. It is now considered stable and has replaced the original <code>S3AOutputStream</code>, which is no longer shipped in hadoop.</p>
<p>The &#x201c;fast&#x201d; output stream</p>
<ol style="list-style-type: decimal">

<li>Uploads large files as blocks with the size set by <code>fs.s3a.multipart.size</code>. That is: the threshold at which multipart uploads begin and the size of each upload are identical. This behavior can be enabled or disabled by using the flag <code>fs.s3a.multipart.uploads.enabled</code> which by default is set to true.</li>
<li>Buffers blocks to disk (default) or in on-heap or off-heap memory.</li>
<li>Uploads blocks in parallel in background threads.</li>
<li>Begins uploading blocks as soon as the buffered data exceeds this partition size.</li>
<li>When buffering data to disk, uses the directory/directories listed in <code>fs.s3a.buffer.dir</code>. The size of data which can be buffered is limited to the available disk space.</li>
<li>Generates output statistics as metrics on the filesystem, including statistics of active and pending block uploads.</li>
<li>Has the time to <code>close()</code> set by the amount of remaining data to upload, rather than the total size of the file.</li>
</ol>
<p>Because it starts uploading while data is still being written, it offers significant benefits when very large amounts of data are generated. The in memory buffering mechanisms may also offer speedup when running adjacent to S3 endpoints, as disks are not used for intermediate data storage.</p>

<div class="source">
<div class="source">
<pre>&lt;property&gt;
  &lt;name&gt;fs.s3a.fast.upload.buffer&lt;/name&gt;
  &lt;value&gt;disk&lt;/value&gt;
  &lt;description&gt;
    The buffering mechanism to use.
    Values: disk, array, bytebuffer.

    &quot;disk&quot; will use the directories listed in fs.s3a.buffer.dir as
    the location(s) to save data prior to being uploaded.

    &quot;array&quot; uses arrays in the JVM heap

    &quot;bytebuffer&quot; uses off-heap memory within the JVM.

    Both &quot;array&quot; and &quot;bytebuffer&quot; will consume memory in a single stream up to the number
    of blocks set by:

        fs.s3a.multipart.size * fs.s3a.fast.upload.active.blocks.

    If using either of these mechanisms, keep this value low

    The total number of threads performing work across all threads is set by
    fs.s3a.threads.max, with fs.s3a.max.total.tasks values setting the number of queued
    work items.
  &lt;/description&gt;
&lt;/property&gt;

&lt;property&gt;
  &lt;name&gt;fs.s3a.multipart.size&lt;/name&gt;
  &lt;value&gt;100M&lt;/value&gt;
  &lt;description&gt;How big (in bytes) to split upload or copy operations up into.
    A suffix from the set {K,M,G,T,P} may be used to scale the numeric value.
  &lt;/description&gt;
&lt;/property&gt;

&lt;property&gt;
  &lt;name&gt;fs.s3a.fast.upload.active.blocks&lt;/name&gt;
  &lt;value&gt;8&lt;/value&gt;
  &lt;description&gt;
    Maximum Number of blocks a single output stream can have
    active (uploading, or queued to the central FileSystem
    instance's pool of queued operations.

    This stops a single stream overloading the shared thread pool.
  &lt;/description&gt;
&lt;/property&gt;
</pre></div></div>

<p><b>Notes</b></p>
<ul>

<li>

<p>If the amount of data written to a stream is below that set in <code>fs.s3a.multipart.size</code>, the upload is performed in the <code>OutputStream.close()</code> operation &#x2014;as with the original output stream.</p>
</li>
<li>

<p>The published Hadoop metrics monitor include live queue length and upload operation counts, so identifying when there is a backlog of work/ a mismatch between data generation rates and network bandwidth. Per-stream statistics can also be logged by calling <code>toString()</code> on the current stream.</p>
</li>
<li>

<p>Files being written are still invisible until the write completes in the <code>close()</code> call, which will block until the upload is completed.</p>
</li>
</ul><section>
<h3><a name="Buffering_upload_data_on_disk_fs.s3a.fast.upload.buffer.3Ddisk"></a><a name="upload_disk"></a>Buffering upload data on disk <code>fs.s3a.fast.upload.buffer=disk</code></h3>
<p>When <code>fs.s3a.fast.upload.buffer</code> is set to <code>disk</code>, all data is buffered to local hard disks prior to upload. This minimizes the amount of memory consumed, and so eliminates heap size as the limiting factor in queued uploads &#x2014;exactly as the original &#x201c;direct to disk&#x201d; buffering.</p>

<div class="source">
<div class="source">
<pre>&lt;property&gt;
  &lt;name&gt;fs.s3a.fast.upload.buffer&lt;/name&gt;
  &lt;value&gt;disk&lt;/value&gt;
&lt;/property&gt;

&lt;property&gt;
  &lt;name&gt;fs.s3a.buffer.dir&lt;/name&gt;
  &lt;value&gt;${env.LOCAL_DIRS:-${hadoop.tmp.dir}}/s3a&lt;/value&gt;
  &lt;description&gt;Comma separated list of directories that will be used to buffer file
    uploads to.
    Yarn container path will be used as default value on yarn applications,
    otherwise fall back to hadoop.tmp.dir
  &lt;/description&gt;
&lt;/property&gt;
</pre></div></div>

<p>This is the default buffer mechanism. The amount of data which can be buffered is limited by the amount of available disk space.</p></section><section>
<h3><a name="Buffering_upload_data_in_ByteBuffers:_fs.s3a.fast.upload.buffer.3Dbytebuffer"></a><a name="upload_bytebuffer"></a>Buffering upload data in ByteBuffers: <code>fs.s3a.fast.upload.buffer=bytebuffer</code></h3>
<p>When <code>fs.s3a.fast.upload.buffer</code> is set to <code>bytebuffer</code>, all data is buffered in &#x201c;Direct&#x201d; ByteBuffers prior to upload. This <i>may</i> be faster than buffering to disk, and, if disk space is small (for example, tiny EC2 VMs), there may not be much disk space to buffer with.</p>
<p>The ByteBuffers are created in the memory of the JVM, but not in the Java Heap itself. The amount of data which can be buffered is limited by the Java runtime, the operating system, and, for YARN applications, the amount of memory requested for each container.</p>
<p>The slower the upload bandwidth to S3, the greater the risk of running out of memory &#x2014;and so the more care is needed in <a href="#upload_thread_tuning">tuning the upload settings</a>.</p>

<div class="source">
<div class="source">
<pre>&lt;property&gt;
  &lt;name&gt;fs.s3a.fast.upload.buffer&lt;/name&gt;
  &lt;value&gt;bytebuffer&lt;/value&gt;
&lt;/property&gt;
</pre></div></div>
</section><section>
<h3><a name="Buffering_upload_data_in_byte_arrays:_fs.s3a.fast.upload.buffer.3Darray"></a><a name="upload_array"></a>Buffering upload data in byte arrays: <code>fs.s3a.fast.upload.buffer=array</code></h3>
<p>When <code>fs.s3a.fast.upload.buffer</code> is set to <code>array</code>, all data is buffered in byte arrays in the JVM&#x2019;s heap prior to upload. This <i>may</i> be faster than buffering to disk.</p>
<p>The amount of data which can be buffered is limited by the available size of the JVM heap. The slower the write bandwidth to S3, the greater the risk of heap overflows. This risk can be mitigated by <a href="#upload_thread_tuning">tuning the upload settings</a>.</p>

<div class="source">
<div class="source">
<pre>&lt;property&gt;
  &lt;name&gt;fs.s3a.fast.upload.buffer&lt;/name&gt;
  &lt;value&gt;array&lt;/value&gt;
&lt;/property&gt;
</pre></div></div>
</section><section>
<h3><a name="Upload_Thread_Tuning"></a><a name="upload_thread_tuning"></a>Upload Thread Tuning</h3>
<p>Both the <a href="#upload_array">Array</a> and <a href="#upload_bytebuffer">Byte buffer</a> buffer mechanisms can consume very large amounts of memory, on-heap or off-heap respectively. The <a href="#upload_disk">disk buffer</a> mechanism does not use much memory up, but will consume hard disk capacity.</p>
<p>If there are many output streams being written to in a single process, the amount of memory or disk used is the multiple of all stream&#x2019;s active memory/disk use.</p>
<p>Careful tuning may be needed to reduce the risk of running out memory, especially if the data is buffered in memory.</p>
<p>There are a number parameters which can be tuned:</p>
<ol style="list-style-type: decimal">

<li>

<p>The total number of threads available in the filesystem for data uploads <i>or any other queued filesystem operation</i>. This is set in <code>fs.s3a.threads.max</code></p>
</li>
<li>

<p>The number of operations which can be queued for execution:, <i>awaiting a thread</i>: <code>fs.s3a.max.total.tasks</code></p>
</li>
<li>

<p>The number of blocks which a single output stream can have active, that is: being uploaded by a thread, or queued in the filesystem thread queue: <code>fs.s3a.fast.upload.active.blocks</code></p>
</li>
<li>

<p>How long an idle thread can stay in the thread pool before it is retired: <code>fs.s3a.threads.keepalivetime</code></p>
</li>
</ol>
<p>When the maximum allowed number of active blocks of a single stream is reached, no more blocks can be uploaded from that stream until one or more of those active blocks&#x2019; uploads completes. That is: a <code>write()</code> call which would trigger an upload of a now full datablock, will instead block until there is capacity in the queue.</p>
<p>How does that come together?</p>
<ul>

<li>

<p>As the pool of threads set in <code>fs.s3a.threads.max</code> is shared (and intended to be used across all threads), a larger number here can allow for more parallel operations. However, as uploads require network bandwidth, adding more threads does not guarantee speedup.</p>
</li>
<li>

<p>The extra queue of tasks for the thread pool (<code>fs.s3a.max.total.tasks</code>) covers all ongoing background S3A operations (future plans include: parallelized rename operations, asynchronous directory operations).</p>
</li>
<li>

<p>When using memory buffering, a small value of <code>fs.s3a.fast.upload.active.blocks</code> limits the amount of memory which can be consumed per stream.</p>
</li>
<li>

<p>When using disk buffering a larger value of <code>fs.s3a.fast.upload.active.blocks</code> does not consume much memory. But it may result in a large number of blocks to compete with other filesystem operations.</p>
</li>
</ul>
<p>We recommend a low value of <code>fs.s3a.fast.upload.active.blocks</code>; enough to start background upload without overloading other parts of the system, then experiment to see if higher values deliver more throughput &#x2014;especially from VMs running on EC2.</p>

<div class="source">
<div class="source">
<pre>&lt;property&gt;
  &lt;name&gt;fs.s3a.fast.upload.active.blocks&lt;/name&gt;
  &lt;value&gt;4&lt;/value&gt;
  &lt;description&gt;
    Maximum Number of blocks a single output stream can have
    active (uploading, or queued to the central FileSystem
    instance's pool of queued operations.

    This stops a single stream overloading the shared thread pool.
  &lt;/description&gt;
&lt;/property&gt;

</pre></div></div>
</section><section>
<h3><a name="Cleaning_up_after_partial_Upload_Failures"></a><a name="multipart_purge"></a>Cleaning up after partial Upload Failures</h3>
<p>There are four mechanisms for cleaning up after leftover multipart uploads: - AWS Lifecycle rules. This is the simplest and SHOULD be used unless there are are good reasons, such as the store not supporting lifecycle rules. - Hadoop s3guard CLI commands for listing and deleting uploads by their age. Documented in the <a href="./s3guard.html">S3Guard</a> section. - Setting <code>fs.s3a.directory.operations.purge.uploads</code> to <code>true</code> for automatic scan and delete during directory rename and delete - The configuration parameter <code>fs.s3a.multipart.purge</code>, covered below.</p>
<p>If a large stream write operation is interrupted, there may be intermediate partitions uploaded to S3 &#x2014;data which will be billed for. If an S3A committer job is halted partway through, again, there may be many incomplete multipart uploads in the output directory.</p>
<p>These charges can be reduced by enabling <code>fs.s3a.multipart.purge</code>, and setting a purge time in seconds, such as 24 hours. When an S3A FileSystem instance is instantiated with the purge time greater than zero, it will, on startup, delete all outstanding partition requests older than this time. However, this makes filesystem instantiate slow, especially against very large buckets, as a full scan is made.</p>
<p>Consider avoiding this in future.</p>

<div class="source">
<div class="source">
<pre>&lt;property&gt;
  &lt;name&gt;fs.s3a.multipart.purge&lt;/name&gt;
  &lt;value&gt;true&lt;/value&gt;
  &lt;description&gt;True if you want to purge existing multipart uploads that may not have been
     completed/aborted correctly&lt;/description&gt;
&lt;/property&gt;

&lt;property&gt;
  &lt;name&gt;fs.s3a.multipart.purge.age&lt;/name&gt;
  &lt;value&gt;24h&lt;/value&gt;
  &lt;description&gt;Minimum age in seconds of multipart uploads to purge&lt;/description&gt;
&lt;/property&gt;
</pre></div></div>

<p>If an S3A client is instantiated with <code>fs.s3a.multipart.purge=true</code>, it will delete all out of date uploads <i>in the entire bucket</i>. That is: it will affect all multipart uploads to that bucket, from all applications.</p>
<p>Leaving <code>fs.s3a.multipart.purge</code> to its default, <code>false</code>, means that the client will not make any attempt to reset or change the partition rate.</p>
<p>The best practise for using this option is to disable multipart purges in normal use of S3A, enabling only in manual/scheduled housekeeping operations.</p></section><section>
<h3><a name="S3A_.E2.80.9Cfadvise.E2.80.9D_input_policy_support"></a>S3A &#x201c;fadvise&#x201d; input policy support</h3>
<p>The S3A Filesystem client supports the notion of input policies, similar to that of the Posix <code>fadvise()</code> API call. This tunes the behavior of the S3A client to optimise HTTP GET requests for the different use cases.</p>
<p>See <a href="./performance.html#fadvise">Improving data input performance through fadvise</a> for the details.</p></section></section><section>
<h2><a name="Metrics"></a><a name="metrics"></a>Metrics</h2>
<p>S3A metrics can be monitored through Hadoop&#x2019;s metrics2 framework. S3A creates its own metrics system called s3a-file-system, and each instance of the client will create its own metrics source, named with a JVM-unique numerical ID.</p>
<p>As a simple example, the following can be added to <code>hadoop-metrics2.properties</code> to write all S3A metrics to a log file every 10 seconds:</p>

<div class="source">
<div class="source">
<pre>s3a-file-system.sink.my-metrics-config.class=org.apache.hadoop.metrics2.sink.FileSink
s3a-file-system.sink.my-metrics-config.filename=/var/log/hadoop-yarn/s3a-metrics.out
*.period=10
</pre></div></div>

<p>Lines in that file will be structured like the following:</p>

<div class="source">
<div class="source">
<pre>1511208770680 s3aFileSystem.s3aFileSystem: Context=s3aFileSystem, s3aFileSystemId=892b02bb-7b30-4ffe-80ca-3a9935e1d96e, bucket=bucket,
Hostname=hostname-1.hadoop.apache.com, files_created=1, files_copied=2, files_copied_bytes=10000, files_deleted=5, fake_directories_deleted=3,
directories_created=3, directories_deleted=0, ignored_errors=0, op_copy_from_local_file=0, op_exists=0, op_get_file_status=15, op_glob_status=0,
op_is_directory=0, op_is_file=0, op_list_files=0, op_list_located_status=0, op_list_status=3, op_mkdirs=1, op_rename=2, object_copy_requests=0,
object_delete_requests=6, object_list_requests=23, object_continue_list_requests=0, object_metadata_requests=46, object_multipart_aborted=0,
object_put_bytes=0, object_put_requests=4, object_put_requests_completed=4, stream_write_failures=0, stream_write_block_uploads=0,
stream_write_block_uploads_committed=0, stream_write_block_uploads_aborted=0, stream_write_total_time=0, stream_write_total_data=0,
s3guard_metadatastore_put_path_request=10, s3guard_metadatastore_initialization=0, object_put_requests_active=0, object_put_bytes_pending=0,
stream_write_block_uploads_active=0, stream_write_block_uploads_pending=0, stream_write_block_uploads_data_pending=0,
S3guard_metadatastore_put_path_latencyNumOps=0, S3guard_metadatastore_put_path_latency50thPercentileLatency=0,
S3guard_metadatastore_put_path_latency75thPercentileLatency=0, S3guard_metadatastore_put_path_latency90thPercentileLatency=0,
S3guard_metadatastore_put_path_latency95thPercentileLatency=0, S3guard_metadatastore_put_path_latency99thPercentileLatency=0
</pre></div></div>

<p>Depending on other configuration, metrics from other systems, contexts, etc. may also get recorded, for example the following:</p>

<div class="source">
<div class="source">
<pre>1511208770680 metricssystem.MetricsSystem: Context=metricssystem, Hostname=s3a-metrics-4.gce.cloudera.com, NumActiveSources=1, NumAllSources=1,
NumActiveSinks=1, NumAllSinks=0, Sink_fileNumOps=2, Sink_fileAvgTime=1.0, Sink_fileDropped=0, Sink_fileQsize=0, SnapshotNumOps=5,
SnapshotAvgTime=0.0, PublishNumOps=2, PublishAvgTime=0.0, DroppedPubAll=0
</pre></div></div>

<p>Note that low-level metrics from the AWS SDK itself are not currently included in these metrics.</p></section><section>
<h2><a name="Other_Topics"></a><a name="further_reading"></a> Other Topics</h2><section>
<h3><a name="Copying_Data_with_distcp"></a><a name="distcp"></a> Copying Data with distcp</h3>
<p>Hadoop&#x2019;s <code>distcp</code> tool is often used to copy data between a Hadoop cluster and Amazon S3. See <a class="externalLink" href="https://hortonworks.github.io/hdp-aws/s3-copy-data/index.html">Copying Data Between a Cluster and Amazon S3</a> for details on S3 copying specifically.</p>
<p>The <code>distcp update</code> command tries to do incremental updates of data. It is straightforward to verify when files do not match when they are of different length, but not when they are the same size.</p>
<p>Distcp addresses this by comparing file checksums on the source and destination filesystems, which it tries to do <i>even if the filesystems have incompatible checksum algorithms</i>.</p>
<p>The S3A connector can provide the HTTP etag header to the caller as the checksum of the uploaded file. Doing so will break distcp operations between hdfs and s3a.</p>
<p>For this reason, the etag-as-checksum feature is disabled by default.</p>

<div class="source">
<div class="source">
<pre>&lt;property&gt;
  &lt;name&gt;fs.s3a.etag.checksum.enabled&lt;/name&gt;
  &lt;value&gt;false&lt;/value&gt;
  &lt;description&gt;
    Should calls to getFileChecksum() return the etag value of the remote
    object.
    WARNING: if enabled, distcp operations between HDFS and S3 will fail unless
    -skipcrccheck is set.
  &lt;/description&gt;
&lt;/property&gt;
</pre></div></div>

<p>If enabled, <code>distcp</code> between two S3 buckets can use the checksum to compare objects. Their checksums should be identical if they were either each uploaded as a single file PUT, or, if in a multipart PUT, in blocks of the same size, as configured by the value <code>fs.s3a.multipart.size</code>.</p>
<p>To disable checksum verification in <code>distcp</code>, use the <code>-skipcrccheck</code> option:</p>

<div class="source">
<div class="source">
<pre>hadoop distcp -update -skipcrccheck -numListstatusThreads 40 /user/alice/datasets s3a://alice-backup/datasets
</pre></div></div>
</section><section>
<h3><a name="Advanced_-_Custom_Signers"></a><a name="customsigners"></a> Advanced - Custom Signers</h3>
<p>AWS uees request signing to authenticate requests. In general, there should be no need to override the signers, and the defaults work out of the box. If, however, this is required - this section talks about how to configure custom signers. There&#x2019;s 2 broad config categories to be set - one for registering a custom signer and another to specify usage.</p><section>
<h4><a name="Registering_Custom_Signers"></a>Registering Custom Signers</h4>

<div class="source">
<div class="source">
<pre>&lt;property&gt;
  &lt;name&gt;fs.s3a.custom.signers&lt;/name&gt;
  &lt;value&gt;comma separated list of signers&lt;/value&gt;
  &lt;!-- Example
  &lt;value&gt;AWS4SignerType,CS1:CS1ClassName,CS2:CS2ClassName:CS2InitClass&lt;/value&gt;
  --&gt;
&lt;/property&gt;
</pre></div></div>

<p>Acceptable value for each custom signer</p>
<p><code>SignerName</code>- this is used in case one of the default signers is being used. (E.g <code>AWS4SignerType</code>, <code>QueryStringSignerType</code>, <code>AWSS3V4SignerType</code>). If no custom signers are being used - this value does not need to be set.</p>
<p><code>SignerName:SignerClassName</code> - register a new signer with the specified name, and the class for this signer. The Signer Class must implement <code>software.amazon.awssdk.core.signer.Signer</code>.</p>
<p><code>SignerName:SignerClassName:SignerInitializerClassName</code> - similar time above except also allows for a custom SignerInitializer (<code>org.apache.hadoop.fs.s3a.AwsSignerInitializer</code>) class to be specified.</p></section><section>
<h4><a name="Usage_of_the_Signers"></a>Usage of the Signers</h4>
<p>Signers can be set at a per-service level (S3, etc) or a common signer for all services.</p>

<div class="source">
<div class="source">
<pre>&lt;property&gt;
  &lt;name&gt;fs.s3a.s3.signing-algorithm&lt;/name&gt;
  &lt;value&gt;${S3SignerName}&lt;/value&gt;
  &lt;description&gt;Specify the signer for S3&lt;/description&gt;
&lt;/property&gt;

&lt;property&gt;
  &lt;name&gt;fs.s3a.signing-algorithm&lt;/name&gt;
  &lt;value&gt;${SignerName}&lt;/value&gt;
&lt;/property&gt;
</pre></div></div>

<p>For a specific service, the service specific signer is looked up first. If that is not specified, the common signer is looked up. If this is not specified as well, SDK settings are used.</p></section></section></section>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
        &#169;            2008-2024
              Apache Software Foundation
            
                          - <a href="http://maven.apache.org/privacy-policy.html">Privacy Policy</a>.
        Apache Maven, Maven, Apache, the Apache feather logo, and the Apache Maven project logos are trademarks of The Apache Software Foundation.
      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
